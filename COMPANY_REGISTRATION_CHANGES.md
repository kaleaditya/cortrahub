# Company Registration System Changes

## Overview
The company registration system has been updated to implement an admin approval workflow with email-based credential delivery, similar to the trainer registration system.

## Changes Made

### 1. Database Changes
- Added new columns to `companies` table:
  - `status` (enum: 'pending', 'sent') - default: 'pending'
  - `username` (string) - nullable
  - `show_password` (string) - nullable  
  - `email_sent_at` (timestamp) - nullable

### 2. Registration Form Changes
- **Removed password and confirm password fields** from company registration form
- Added informational message about admin approval process
- Companies can no longer set their own passwords

### 3. Registration Process
- Companies register with basic information only
- System generates temporary password (12345678)
- Status is set to 'pending' by default
- Companies cannot login until approved

### 4. Admin Approval Process
- Admin can view all company registrations in the admin panel
- New "Send-Email" column shows status (Pending/Sent)
- Admin can click "Pending" button to send approval email
- Email contains login credentials (username and password)
- Status changes to 'sent' after email is sent

### 5. Email System
- Created `CompanyApprovalMail` class
- Professional email template with login credentials
- Includes login link and security instructions

### 6. Login System
- Companies cannot login if status is 'pending'
- Clear error message directs them to wait for approval
- Only approved companies can access the system

## Files Modified/Created

### New Files:
- `database/migrations/2025_07_20_000001_add_status_fields_to_companies_table.php`
- `app/Mail/CompanyApprovalMail.php`
- `resources/views/emails/company_approval.blade.php`
- `COMPANY_REGISTRATION_CHANGES.md`

### Modified Files:
- `app/Models/Company.php` - Added new fillable fields
- `app/Http/Controllers/CompanyAuthController.php` - Updated registration and login logic
- `resources/views/company_register.blade.php` - Removed password fields
- `resources/views/company/index.blade.php` - Added status column and send email functionality
- `routes/web.php` - Added approval email route

## Usage

### For Companies:
1. Visit `/company_register` or `/company/register`
2. Fill in company details (no password required)
3. Submit registration
4. Wait for admin approval email
5. Use provided credentials to login

### For Admins:
1. Go to company listing page
2. View "Send-Email" column
3. Click "Pending" button for companies to approve
4. System sends email with credentials
5. Status changes to "Sent"

## Security Features
- Companies cannot set their own passwords
- Temporary passwords are generated by system
- Clear approval workflow prevents unauthorized access
- Email-based credential delivery ensures secure communication

## Email Template Features
- Professional design with company branding
- Clear login credentials display
- Security instructions for password change
- Direct login link
- Responsive design for mobile devices

## Migration Notes
- Existing companies will have status set to 'pending'
- New registrations automatically get 'pending' status
- No data loss during migration

## Testing
1. Register a new company (should not require password)
2. Check admin panel shows "Pending" status
3. Send approval email (should change to "Sent")
4. Try logging in with pending company (should be blocked)
5. Try logging in with approved company (should work)

## Future Enhancements
- Password change functionality for companies
- Email templates customization
- Bulk approval functionality
- Approval history tracking
- Email delivery status tracking 