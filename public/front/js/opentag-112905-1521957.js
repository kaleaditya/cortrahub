/*
 * OpenTag, a tag deployment platform
 * Copyright 2011-2016, Qubit.com
 * http://opentag.qubitproducts.com
 */

try{(function(){(function(){if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,FNOP=function(){},fBound=function(){return fToBind.apply(this instanceof FNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};FNOP.prototype=this.prototype;fBound.prototype=new FNOP();return fBound}}}());var PKG_ROOT={__anonymous__:true};var GLOBAL=null;try{GLOBAL=(false||eval)("this")||(function(){return this}())}catch(e){}PKG_ROOT=GLOBAL;var qubit=PKG_ROOT.qubit||{};if(!PKG_ROOT.qubit){PKG_ROOT.qubit=qubit}qubit.VERSION="1.1.13";try{module.exports=PKG_ROOT}catch(e){}var EMPTY_FUN=function(){};var UNDEF;(function(){function Define(){}Define.global=function(){return GLOBAL};Define.globalNamespace=function(path,instance,pckg,noOverride){return _namespace(path,instance,pckg,noOverride,true)};Define.namespace=function(path,instance,pckg,noOverride){return _namespace(path,instance,pckg,noOverride,false)};function _namespace(path,instance,pckg,noOverride,isGlobal){var files=path.split("."),current=Define.NAMESPACE_BASE||PKG_ROOT,last=null,lastName=null,i;if(isGlobal){current=GLOBAL}var root=current;current=pckg||current;for(i=0;i<files.length-1;i+=1){last=current;lastName=files[i];current[lastName]=current[lastName]||{};current=current[lastName]}last=current;lastName=files[files.length-1];if(GLOBAL.TAGSDK_NS_OVERRIDE){noOverride=false}if(instance!==undefined){if(last[lastName]===undefined||!noOverride){last[lastName]=instance}}else{last[lastName]=last[lastName]||{}}return{root:root,object:last}}Define.clazz=function(path,instance,extendingClass,pckg,config){Define.namespace(path,instance,pckg,true);if(typeof(extendingClass)==="function"){instance.superclass=extendingClass;instance.prototype=new instance.superclass(config)}var names=path.split(".");if(instance.prototype){instance.prototype.CLASS_NAME=names[names.length-1];names.splice(names.length-1,1);instance.prototype.PACKAGE_NAME=names.join(".")}else{instance.STATIC_NAME=names[names.length-1];names.splice(names.length-1,1);instance.PACKAGE_NAME=names.join(".")}return instance};Define.clazz("qubit.Define",Define)}());(function(){var cookieAlphabet="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=";var cookieAlphabetMap={};for(var i=0;i<cookieAlphabet.length;i++){cookieAlphabetMap[cookieAlphabet.charAt(i)]=i}function Cookie(config){}qubit.Define.clazz("qubit.Cookie",Cookie);Cookie.cookieAlphabet=cookieAlphabet;Cookie.cookieAlphabetMap=cookieAlphabetMap;Cookie.decode=function(string){return unescape(string)};Cookie.encode=function(string){return escape(string)};Cookie.set=function(name,value,days,domain,notEncoded){var expires;if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}else{expires=""}if(!notEncoded){name=Cookie.encode(name);value=Cookie.encode(value)}var cookie=name+"="+value+expires+"; path=/;";if(domain){cookie+=" domain="+domain}document.cookie=cookie};Cookie.get=function(name,notDecoded){var part=name+"=";var chunks=document.cookie.split(";");for(var i=0;i<chunks.length;i++){var chunk=chunks[i];while(chunk.charAt(0)===" "){chunk=chunk.substring(1,chunk.length)}if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(!notDecoded){tmp=Cookie.decode(tmp)}return tmp}}return null};Cookie.getAllForName=function(name,decoded){if(!name){return[]}var part=name+"=";var chunks=document.cookie.split(";");var cookies=[];for(var i=0;i<chunks.length;i++){var chunk=chunks[i];while(chunk.charAt(0)===" "){chunk=chunk.substring(1,chunk.length)}if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(decoded){tmp=Cookie.decode(tmp)}cookies.push(tmp)}}return cookies};Cookie.getAll=function(decoded){var chunks=document.cookie.split(";");var cookies=[];for(var i=0;i<chunks.length;i++){var chunk=chunks[i];while(chunk.charAt(0)===" "){chunk=chunk.substring(1,chunk.length)}var name=chunk.substring(0,chunk.indexOf("="));var tmp=chunk.substring(name.length+1,chunk.length);if(decoded){tmp=Cookie.decode(tmp)}cookies.push([name,tmp])}return cookies};Cookie.rm=function(name,domain){Cookie.set(name,"",-1,domain)}})();(function(){var Define=qubit.Define;function Utils(){}var global=Define.global();Define.clazz("qubit.opentag.Utils",Utils);Utils.global=Define.global;Utils.namespace=Define.namespace;Utils.clazz=Define.clazz;Utils.getObjectUsingPath=function(path,base){base=base||global;var parts=path.split(".");for(var i=0;i<parts.length;i++){if(base&&parts[i]){base=base[parts[i]]}}return base};Utils.variableExists=function(value){return(value!==undefined)&&(value!==null)};Utils.ANON_VARS=[];Utils.getAnonymousAcessor=function(obj){var index=Utils.indexInArray(obj,Utils.ANON_VARS);if(index===-1){index=addAnonymousAcessor(obj)}return"qubit.opentag.Utils.ANON_VARS["+index+"]"};function addAnonymousAcessor(obj){return Utils.addToArrayIfNotExist(Utils.ANON_VARS,obj)}function escapeRegExp(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}Utils.replaceAll=function(string,pattern,replace){return string.replace(new RegExp(escapeRegExp(pattern),"g"),replace)};Utils.secureText=function(string){if(typeof(string)!=="string"){string+=""}string=string.replace(/</g,"&lt;");string=string.replace(/>/g,"&gt;");return string};Utils.getUrl=function(){return document.location.href};Utils.getQueryParam=function(param){var i,ii,params,url,query,queries,splitQuery;url=Utils.getUrl();if(url.indexOf("?")>0){queries=url.substring(url.indexOf("?")+1).split("&");for(i=0,ii=queries.length;i<ii;i+=1){query=queries[i];if(query.indexOf("=")>0){splitQuery=query.split("=");if((splitQuery.length===2)&&(splitQuery[0]===param)){return splitQuery[1]}}}}return null};Utils.getElementValue=function(elementId){var el=document.getElementById(elementId);if(el){return el.textContent||el.innerText}return null};var travelArray=[];function existsInPath(object,copy){var len=travelArray.length;for(var i=0;i<len;i++){if(object===travelArray[i][0]){return travelArray[i][1]}}travelArray[travelArray.length]=[object,copy];return false}Utils.objectCopy=function(obj,cfg){cfg=cfg||{};var res=_objectCopy(obj,cfg,cfg.maxDeep);travelArray=[];return res};function _objectCopy(obj,cfg,maxDeep,start,parentObj){var nodes=false,noOwn=false,noFunctions=false,win=false,all=false,copyReference=false,emptyForMaxDeep=false;if(cfg){all=!!cfg.all;nodes=all||cfg.nodes;win=all||cfg.win;noOwn=all;emptyForMaxDeep=!!cfg.emptyForMaxDeep;noFunctions=cfg.noFunctions&&!all;if(cfg.noOwn!==undefined){noOwn=!!cfg.noOwn}if(cfg.noFunctions!==undefined){noFunctions=!!cfg.noFunctions}if(cfg.win!==undefined){win=!!cfg.win}if(cfg.nodes!==undefined){nodes=!!cfg.nodes}copyReference=!!cfg.copyReference}if(maxDeep!==undefined&&!maxDeep){if(emptyForMaxDeep){return}return obj}else{if(maxDeep!==undefined){maxDeep--}}if(!obj||!(obj instanceof Object)){return obj}if(!nodes){try{if(obj instanceof Node){return obj}}catch(ie){if(obj instanceof ActiveXObject&&obj.nodeType!==undefined){return obj}}if(obj===document){return obj}}if(!win){if(obj===global){return obj}}var copy=(obj instanceof Array)?[]:{};if(obj instanceof Date){copy=new Date(obj)}if(!noFunctions&&obj instanceof Function){var funStr=String(obj).replace(/\s+/g,"");if((funStr.indexOf("{[nativecode]}")+14)===funStr.length){copy=function(){return obj.apply(parentObj||this,arguments)}}else{copy=function(){return obj.apply(this,arguments)}}}if(start===undefined){travelArray=[];start=0}var existingCopy=existsInPath(obj,copy);if(existingCopy){return existingCopy}var i;if(copy instanceof Array){for(i=0;i<obj.length;i++){if(obj[i]===obj[i]){copy[copy.length]=_objectCopy(obj[i],cfg,maxDeep,start+1,obj)}else{copy[copy.length]=obj[i]}}}else{i=0;for(var prop in obj){if(noOwn||obj.hasOwnProperty(prop)){if(obj[prop]===obj[prop]){copy[prop]=_objectCopy(obj[prop],cfg,maxDeep,start+1,obj)
}else{copy[prop]=obj[prop]}}i++}}if(cfg.proto){copy.prototype=_objectCopy(obj.prototype,cfg,maxDeep,start+1,obj)}if(copyReference){copy.___copy_ref=obj}return copy}var traverseArray=[];function existsInTraversePath(object,max){for(var i=0;i<max&&i<traverseArray.length;i++){if(object===traverseArray[i]){return true}}return false}Utils.traverse=function(obj,exe,cfg){_traverse(obj,exe,cfg)};function _traverse(obj,exe,cfg,start,parent,prop,trackPath){cfg=cfg||{};if(cfg.hasOwn===undefined){cfg.hasOwn=true}if(cfg.objectsOnly&&!(obj instanceof Object)){return}if(cfg.maxDeep!==undefined&&!cfg.maxDeep){return}else{if(cfg.maxDeep!==undefined){cfg.maxDeep--}}if(!cfg||!cfg.nodes){try{if(obj instanceof Node){return}}catch(ie){if(obj instanceof ActiveXObject&&obj.nodeType!==undefined){return}}}if(obj===global){return}if(start===undefined){traverseArray=[];start=0}if(existsInTraversePath(obj,start)){return}traverseArray[start]=obj;parent=parent||obj;if(parent&&prop&&(parent[prop]!==parent[prop])){return}var stopHere=exe(obj,parent,prop,trackPath);if(stopHere){return}var i=0;var objPath="";for(var pprop in obj){if(!cfg.hasOwn||(obj.hasOwnProperty(pprop))){try{var object=obj[pprop];if(cfg.track){objPath=trackPath?(trackPath+"."+pprop):pprop}_traverse(object,exe,cfg,start+1,parent,pprop,objPath)}catch(e){}}i++}}Utils.prepareQuotedString=function(string){if(typeof(string)==="string"){return'"'+(string.replace(/\"/g,'\\"'))+'"'}else{return string}};Utils.expressionToFunction=function(expr,argzString){argzString=argzString||"";var funTemplate="function ("+argzString+") {"+expr+"}";return Utils.gevalAndReturn(funTemplate).result};Utils.defineClass=function(classPath,extendingClass,config,pckg){var names=classPath.split(".");var className=names[names.length-1];var clazz;var funTemplate=["clazz = ","(function ",className,"() {","  if (",classPath,"._CONSTRUCTOR) {","    return ",classPath,"._CONSTRUCTOR.apply(this, arguments);","  } else {","    if (",classPath,".superclass) {","      return ",classPath,".superclass.apply(this, arguments);","    }","  }","})"].join("");eval(funTemplate);var CONSTRUCTOR=config.CONSTRUCTOR;clazz._CONSTRUCTOR=CONSTRUCTOR;clazz.superclass=extendingClass;Define.clazz(classPath,clazz,extendingClass,pckg);for(var prop in config){if(config.hasOwnProperty(prop)&&prop!=="CONSTRUCTOR"){clazz.prototype[prop]=config[prop]}}return clazz};Utils.keys=function(obj){if(obj instanceof Object){if(Object.keys){return Object.keys(obj)}var keys=[];for(var prop in obj){if(obj.hasOwnProperty(prop)){keys[keys.length]=prop}}return keys}else{throw"keys() called on non-object!"}};Utils.getSrcElement=function(evt){var elem;evt=evt||window.event;if(evt.srcElement){elem=evt.srcElement}else{if(evt.target){elem=evt.target}}return elem};Utils.addToArrayIfNotExist=function(array,obj){var i=0,exists=false;for(;i<array.length;i+=1){if(array[i]===obj){exists=true;break}}if(!exists){array[array.length]=obj;i=-1}return i};Utils.indexInArray=function(array,obj){var i=0,exists=false;for(;i<array.length;i++){if(array[i]===obj){exists=true;break}}return exists?i:-1};Utils.removeFromArray=function(array,obj){var i=0,total=0;for(;i<array.length;i+=1){if(array[i]===obj){array.splice(i,1);total++}}return total};Utils.addClass=function(node,name){var classes;try{node.classList.add(name)}catch(ex){if(node.className===null){node.className=name;return}classes=node.className.split(" ");Utils.addToArrayIfNotExist(classes,name);node.className=classes.join(" ")}};Utils.removeClass=function(node,name){var classes;try{node.classList.remove(name)}catch(ex){if(node.className===null){node.className="";return}classes=node.className.split(" ");Utils.removeFromArray(classes,name);node.className=classes.join(" ")}};var prefix="try{this.qubitopentagutilsgevalandreturn__var_test__=(";var suffix=");}catch(ex){this.qubitopentagutilsgevalandreturn__var_test__error = ex;}";Utils.gevalAndReturn=function(expression){var G=GLOBAL;G.qubitopentagutilsgevalandreturn__var_test__=undefined;G.qubitopentagutilsgevalandreturn__var_test__error=undefined;expression=prefix+expression+suffix;Utils.geval(expression);var res=G.qubitopentagutilsgevalandreturn__var_test__;var err=G.qubitopentagutilsgevalandreturn__var_test__error;try{G.qubitopentagutilsgevalandreturn__var_test__=UNDEF;G.qubitopentagutilsgevalandreturn__var_test__error=UNDEF;delete G.qubitopentagutilsgevalandreturn__var_test__;delete G.qubitopentagutilsgevalandreturn__var_test__error}catch(ex){}return{result:res,error:err}};Utils.trim=function(string){try{return String(string).trim()}catch(noTrim){return String(string).replace(/^\s+|\s+$/g,"")}};Utils.setIfUnset=function(obj,src){if(obj&&src){for(var prop in src){if(src.hasOwnProperty(prop)&&!obj.hasOwnProperty(prop)){obj[prop]=src[prop]}}}};Utils.geval=function(expression){if(window&&window.execScript){return window.execScript(expression)}else{return(function(){return global["eval"].call(global,expression)}())}};var _readyCalls=[];var _loaded=false;var _flushed=false;Utils.bodyReady=function(callback){if(_flushed){if(callback){callback()}return true}_loaded=_loaded||!!(document.body&&document.readyState==="complete");if(_loaded){_flushed=true;for(var i=0;i<_readyCalls.length;i++){try{_readyCalls[i]()}catch(ex){}}if(callback){callback()}}else{if(callback){_readyCalls.push(callback)}}return _loaded};var oldOnload=global.onload;global.onload=function(e){Utils.bodyReady();if(oldOnload){oldOnload(e)}};(function(){var DOMContentLoaded,isReady=false,readyWait=1,readyList,readyComplete,bindReadyComplete,doScrollCheck;readyComplete=function(wait){var f;if(wait===true){readyWait-=1}if(!readyWait||(wait!==true&&!isReady)){if(!document.body){return setTimeout(readyComplete,1)}isReady=true;if(wait!==true){readyWait-=1;if(readyWait>0){return}}while(readyList.length>0){f=readyList.shift();f()}}};doScrollCheck=function(){if(isReady){return}try{document.documentElement.doScroll("left")}catch(e){setTimeout(doScrollCheck,1);return}readyComplete()};bindReadyComplete=function(){if(readyList){return}readyList=[];if(document.readyState==="complete"){return setTimeout(readyComplete,1)}if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",readyComplete,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",readyComplete);var toplevel=false;try{toplevel=(window.frameElement===null)||(window.frameElement===undefined)}catch(e){}if(document.documentElement.doScroll&&toplevel){doScrollCheck()}}}};var ready=function(fn){bindReadyComplete();if(isReady){setTimeout(fn,1)}else{readyList.push(fn)}};if(document.addEventListener){DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);readyComplete()}}else{if(document.attachEvent){DOMContentLoaded=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);readyComplete()}}}}ready(function(){_loaded=true;Utils.bodyReady()})}())}());(function(){function Timer(config){if(config){this._rate=config.rate||10;this._smallestRate=-1;if(config.start){this.startPooling()}this.config=config}this.inervals=[];this._lck_obj={};this._binded_pool=this._pool.bind(this)}qubit.Define.clazz("qubit.opentag.Timer",Timer);Timer.prototype.timers=[];Timer.prototype.startPooling=function(smallestRate){if(smallestRate&&this.config.dynamic){if(this._smallestRate<0||this._smallestRate>smallestRate){this._smallestRate=Math.min(Math.floor(smallestRate/2),1500)}}if(!this.started){this.started=true;setTimeout(this._binded_pool,0)}};Timer.prototype._pool=function(){this.maxFrequent(function(){var name="";if(this.config&&this.config.name){name="["+this.config.name+"]"}},5000,this._lck_obj);this.callTimers();if(this.timers.length!==0){var rate=(this._smallestRate>this._rate)?this._smallestRate:this._rate;setTimeout(this._binded_pool,rate)}else{this.started=false;this._smallestRate=-1}};Timer.prototype.callTimers=function(){this.lastCalled=new Date().valueOf();
for(var i=0;i<this.timers.length;i++){var timer=this.timers[i];var stamp=new Date().valueOf();if(stamp>=timer.time){try{timer.execute()}catch(e){}this.timers.splice(i,1);--i}}};Timer.prototype.cancellAll=function(){this.timers=[]};Timer.prototype.setRate=function(time){this._rate=time};Timer.prototype.maxFrequent=function(fun,time,lockObj){if(!lockObj){fun.__maxFrequent__timer_opentag_qubit_=fun.__maxFrequent__timer_opentag_qubit_||{};lockObj=fun.__maxFrequent__timer_opentag_qubit_}var last=lockObj.____last__timed__max__frequent____;if(!last||(new Date().valueOf()-last)>time){last=new Date().valueOf();lockObj.____last__timed__max__frequent____=last;fun()}};Timer.prototype.runIfNotScheduled=function(fun,time,lockObj){if(lockObj.__lastRun__&&(new Date().valueOf()<(time+lockObj.__lastRun__))){return this.schedule(fun,time,lockObj)}else{lockObj.__lastRun__=new Date().valueOf();fun();return true}};Timer.prototype.schedule=function(fun,time,lockObj){if(lockObj.___scheduled___){return false}else{lockObj.___scheduled___=new Date().valueOf();this.setTimeout(function(){lockObj.___scheduled___=false;lockObj.__lastRun__=new Date().valueOf();fun()},time);return true}};var ids=1;Timer.prototype.setTimeout=function(call,time){var timer={id:ids++,time:new Date().valueOf()+(+time),execute:call};this.timers.push(timer);this.startPooling(time);return timer};Timer.prototype.setInterval=function(call,time){var interv=setInterval(call,time);this.inervals.push(interv);return interv}})();(function(){qubit.Define.namespace("qubit.opentag.Timed",new qubit.opentag.Timer({rate:37,dynamic:true}));var Timed=qubit.opentag.Timed;Timed.tillTrue=function(test,callback,often){var runner=function(){if(!test()){Timed.setTimeout(runner,often||33)}else{callback()}};runner()}})();var q={};q.html=q.html||{};q.html.fileLoader={};q.html.fileLoader.load=function(url,preLoadAction,postLoadHandler,parentNode,async,attributes){var scriptEl,preLoadResult,loadError,doPostLoad,loaded;loaded=false;doPostLoad=function(loadFailed){return function(){if(!loaded){loaded=true;if(loadFailed&&!loadError){loadError={url:document.location.href}}postLoadHandler(url,loadError,loadFailed)}}};try{if(preLoadAction){preLoadResult=preLoadAction(url)}}catch(e){preLoadResult=false;postLoadHandler(url,"Exception loading pre",true)}finally{if(preLoadResult!==false){scriptEl=q.html.fileLoader.createScriptEl(url,async,false,attributes);if(postLoadHandler){scriptEl.onload=doPostLoad(false);scriptEl.onerror=doPostLoad(true);scriptEl.onreadystatechange=function(){if((this.readyState==="complete")||(this.readyState==="loaded")){setTimeout(function(){doPostLoad(false)()},1)}}}if(!parentNode){parentNode=window.document.getElementsByTagName("head")[0]}parentNode.appendChild(scriptEl)}}};q.html.fileLoader.createScriptEl=function(path,async,forceReload,attr){var a,scriptEl=document.createElement("script");scriptEl.type="text/javascript";scriptEl.src=q.html.fileLoader.tidyUrl(path)+(forceReload?("?"+new Date().getTime()):"");if(async!==false){scriptEl.async="true";scriptEl.defer="true"}else{scriptEl.async="false";if(scriptEl.async!==false){scriptEl.async=false}scriptEl.defer="false"}for(a in attr){if(attr.hasOwnProperty(a)){scriptEl.setAttribute(a,attr[a])}}return scriptEl};q.html.fileLoader.tidyUrl=function(path){if(path.substring(0,5)==="http:"){return path}if(path.substring(0,6)==="https:"){return path}return"//"+path};(function(){var counter=0;function BaseFilter(config){this.config={order:0,include:true,name:"Filter-"+(counter++),script:undefined,session:undefined};this.session=null;if(config){for(var prop in config){if(config.hasOwnProperty(prop)){this.config[prop]=config[prop]}}if(config.session){this.setSession(config.session)}}}qubit.Define.clazz("qubit.opentag.filter.BaseFilter",BaseFilter);BaseFilter.state={DISABLED:-3,SESSION:-2,PASS:-1,FAIL:0};BaseFilter.prototype.reset=function(){this.enable()};BaseFilter.prototype.disable=function(){this.config.disabled=true};BaseFilter.prototype.enable=function(){this.config.disabled=false};BaseFilter.prototype.match=function(){return true};BaseFilter.prototype.setSession=function(session){this.session=session};BaseFilter.prototype.getSession=function(){return this.session};BaseFilter.prototype.getState=function(){var passed=BaseFilter.state.PASS;if(this.config.disabled){return BaseFilter.state.DISABLED}if(this.config.script){passed=this.config.script.call(this,passed)}if(isNaN(+passed)){passed=BaseFilter.state.FAIL}this.lastState=+passed;return passed}}());(function(){var BaseFilter=qubit.opentag.filter.BaseFilter;function SessionVariableFilter(config){var defaultConfig={};if(config){for(var prop in config){if(config.hasOwnProperty(prop)){if(prop==="customStarter"&&config[prop]){this.customStarter=config[prop]}else{if(prop==="customScript"&&config[prop]){this.customScript=config[prop]}}defaultConfig[prop]=config[prop]}}}SessionVariableFilter.superclass.call(this,defaultConfig)}qubit.Define.clazz("qubit.opentag.filter.SessionVariableFilter",SessionVariableFilter,BaseFilter);SessionVariableFilter.prototype.customStarter=function(session,ready,tag){ready(false)};SessionVariableFilter.prototype.customScript=function(session){return true};SessionVariableFilter.prototype.match=function(){try{if(this._matchState===undefined){this._matchState=!!this.customScript(this.getSession())}return this._matchState}catch(ex){return false}};SessionVariableFilter.prototype.runTag=function(tag){if(!this._runTag){if(this.customStarter){this._runTag=true;this.customStarter(this.getSession(),function(rerun){this.lastRun=new Date().valueOf();if(rerun===true){tag.run()}else{tag.runOnce()}}.bind(this),tag)}}};SessionVariableFilter.prototype.getState=function(session){if(session){this.setSession(session)}var pass=SessionVariableFilter.superclass.prototype.getState.call(this);if(pass===BaseFilter.state.DISABLED){return BaseFilter.state.DISABLED}if(pass===BaseFilter.state.PASS){if(this.customStarter){pass=BaseFilter.state.SESSION}}if(this.config.script){pass=this.config.script.call(this,pass,this.getSession())}this.lastState=pass;return pass};SessionVariableFilter.prototype.reset=function(){this._matchState=undefined;SessionVariableFilter.superclass.prototype.reset.call(this);this._runTag=undefined}}());q.html.GlobalEval={};q.html.GlobalEval.globalEval=function(src){if(window.execScript){window.execScript(src)}else{var fn=function(){window["eval"].call(window,src)};fn()}};q.html.HtmlInjector={};q.html.HtmlInjector.inject=function(el,injectStart,str,cb,parentNode){var i,ii,d,scriptsRaw,scripts,script,contents;if(str.toLowerCase().indexOf("<script")>=0){d=document.createElement("div");d.innerHTML="a"+str;scriptsRaw=d.getElementsByTagName("script");scripts=[];for(i=0,ii=scriptsRaw.length;i<ii;i+=1){scripts.push(scriptsRaw[i])}contents=[];for(i=0,ii=scripts.length;i<ii;i+=1){script=scripts[i];var s={attributes:q.html.HtmlInjector.getAttributes(script)};if(script.src){s.src=script.src}else{s.script=script.innerHTML}contents.push(s);script.parentNode.removeChild(script)}if(d.innerHTML){if(d.innerHTML.length>0){d.innerHTML=d.innerHTML.substring(1)}}q.html.HtmlInjector.doInject(el,injectStart,d);q.html.HtmlInjector.loadScripts(contents,0,cb,el)}else{d=document.createElement("div");d.innerHTML=str;q.html.HtmlInjector.doInject(el,injectStart,d);if(cb){cb()}}};q.html.HtmlInjector.doInject=function(el,injectStart,d){if(d.childNodes.length>0){var fragment=document.createDocumentFragment();while(d.childNodes.length>0){fragment.appendChild(d.removeChild(d.childNodes[0]))}if(injectStart){q.html.HtmlInjector.injectAtStart(el,fragment)}else{q.html.HtmlInjector.injectAtEnd(el,fragment)}}};q.html.HtmlInjector.injectAtStart=function(el,fragment){if(el.childNodes.length===0){el.appendChild(fragment)}else{el.insertBefore(fragment,el.childNodes[0])}};q.html.HtmlInjector.injectAtEnd=function(el,fragment,counter){if(!counter){counter=1}if((el===document.body)&&(document.readyState!=="complete")&&(counter<50)){setTimeout(function(){q.html.HtmlInjector.injectAtEnd(el,fragment,counter+1)
},100)}else{el.appendChild(fragment)}};q.html.HtmlInjector.loadScripts=function(contents,i,cb,parentNode){var ii,c,foundSrc=false;for(ii=contents.length;i<ii;i+=1){c=contents[i];if(c.src){foundSrc=true;break}else{q.html.GlobalEval.globalEval(c.script)}}if(foundSrc){q.html.fileLoader.load(c.src,null,function(){q.html.HtmlInjector.loadScripts(contents,i+1,cb,parentNode)},parentNode,false,c.attributes)}if(cb&&(i===ii)){cb()}};q.html.HtmlInjector.getAttributes=function(node){var a,aLength,attributes,val,name,map={};if(node){attributes=node.attributes;aLength=attributes.length;for(a=0;a<aLength;a++){val=attributes[a].value;name=attributes[a].name.toLowerCase();if((val!=="")&&((name==="id")||(name==="class")||(name==="charset")||(name.substr(0,5)==="data-"))){map[name]=val}}return map}};(function(){var BaseFilter=qubit.opentag.filter.BaseFilter;var Utils=qubit.opentag.Utils;var HtmlInjector=q.html.HtmlInjector;var FileLoader=q.html.fileLoader;var SessionVariableFilter=qubit.opentag.filter.SessionVariableFilter;var TagsUtils=function(){};qubit.Define.clazz("qubit.opentag.TagsUtils",TagsUtils);var _bodyLoaded=false;TagsUtils.bodyLoaded=function(){if(_bodyLoaded){return true}_bodyLoaded=!!(document.body&&document.readyState!=="loading");return _bodyLoaded};TagsUtils.bodyAvailable=function(callback){return !!document.body};var loadedURLs={};var STATE={SUCCESS:"success",FAIL:"failure",INIT:"not started"};TagsUtils.loadScript=function(config){var url=config.url;var loadingCheck=function(passedUrlFromLoader,loadError,loadFailed){loadedURLs[url].error=loadError;if(loadFailed){loadedURLs[url].state=STATE.FAIL;config.onerror()}else{loadedURLs[url].state=STATE.SUCCESS;config.onsuccess()}};if(loadedURLs[url]){if(config.noMultipleLoad){return loadingCheck(url,loadedURLs[url].error,loadedURLs[url].state===STATE.FAIL)}loadedURLs[url].count+=1}else{loadedURLs[url]={count:1,state:null}}var useWrite=!config.async;var loaded=TagsUtils.bodyLoaded();if(useWrite&&loaded){}useWrite=useWrite&&!loaded;if(useWrite){TagsUtils.writeScriptURL(url,function(allOk,error){loadingCheck(url,error,!allOk)})}else{FileLoader.load(url,false,loadingCheck,config.node,config.async)}};var redirectedDocWriteMethods=null;function saveDocWriteMethods(){redirectedDocWriteMethods=redirectedDocWriteMethods||{write:document.write,writeln:document.writeln}}function unlockDocWriteMethods(){document.write=redirectedDocWriteMethods.write;document.writeln=redirectedDocWriteMethods.writeln;redirectedDocWriteMethods=null}TagsUtils.redirectDocumentWritesToArray=function(array,log){var text=array;saveDocWriteMethods();document.write=function(t){text.push(t)};document.writeln=function(t){text.push(t)}};TagsUtils.flushDocWritesArray=function(array,location,append,log,cb){var el=location;if(el&&array){var flushed=array.splice(0,array.length);try{TagsUtils.injectHTML(el,append,flushed.join("\n"),cb||EMPTY_FUN);return true}catch(ex){}}else{var message="Flushing location not found!";return false}if(cb){cb()}return true};TagsUtils.unlockDocumentWrites=function(){if(redirectedDocWriteMethods){unlockDocWriteMethods()}};var accessorBasePath=TagsUtils.prototype.PACKAGE_NAME+".TagsUtils._writeScriptURL_callbacks";var accesorBase={};qubit.Define.namespace(accessorBasePath,accesorBase,GLOBAL,true);var wsCounter=0;var startFrom=new Date().valueOf();TagsUtils.writeScriptURL=function(url,callback){var callName="_"+startFrom+"_"+wsCounter++;var accessorName=accessorBasePath+"."+callName;var called=false;accesorBase[callName]=function(error){if(called){return}called=true;if(error){callback(false,"error while loading script "+url)}else{callback(true)}accesorBase[callName]=undefined;delete TagsUtils.writeScriptURL.callbacks[callName]};var jsIE='if(this.readyState === "loaded" || this.readyState === "complete"){ try {'+accessorName+"(true)} catch (ex) {}}";var jsNonIE="try{"+accessorName+"(false)}catch(ex){}";var jsNonIEerr="try{"+accessorName+"(true)}catch(ex){}";var scr="scr",value;url=FileLoader.tidyUrl(url);value="<"+scr+"ipt onload='"+jsNonIE+"'  onerror='"+jsNonIEerr+"' onreadystatechange='"+jsIE+"' type='text/javascript'  src='"+url+"'></"+scr+"ipt>";if(redirectedDocWriteMethods){unlockDocWriteMethods();document.write(value);saveDocWriteMethods()}else{document.write(value)}Utils.bodyReady(function(){if(!called){called=true;callback(true)}})};TagsUtils.writeScriptURL.callbacks={};var SESSION=BaseFilter.state.SESSION;var PASS=BaseFilter.state.PASS;var FAIL=BaseFilter.state.FAIL;TagsUtils.filtersState=function(filters,session,tag,runLastSessionFilterIfPresent){filters=filters.sort(function(a,b){try{return b.config.order-a.config.order}catch(nex){return 0}});var decision=PASS;if(!filters||(filters.length===0)){return decision}var lastFilterResponded=null;var disabledFiltersPresent=false;var sessionFiltersPresent=false;var waitingResponse=0;var response;var lastSessionFilter;var sessionFiltersToRun=[];var filter;var lastUnmatched;for(var i=0;i<filters.length;i++){filter=filters[i];filter.setSession(session);if(filter.match()){response=filter.getState();if(response>0){if(waitingResponse===0||waitingResponse>response){waitingResponse=response}}else{if(response===BaseFilter.state.DISABLED){disabledFiltersPresent=true}else{if(response===SESSION){sessionFiltersPresent=true;lastFilterResponded=filter;lastSessionFilter=filter;sessionFiltersToRun.push(filter)}else{lastFilterResponded=filter}}}}else{lastUnmatched=filter}}var onlyAwaitingFiltersPresent=false;if(lastFilterResponded===null){onlyAwaitingFiltersPresent=true;if(!disabledFiltersPresent){decision=FAIL}else{decision=PASS}}else{if(lastFilterResponded.config.include){decision=response}else{decision=(response===PASS)?FAIL:PASS}}if(waitingResponse>0&&(decision===PASS||onlyAwaitingFiltersPresent)){decision=waitingResponse}if(decision===SESSION||((decision===PASS)&&sessionFiltersPresent)){if(!lastSessionFilter.config.include){return FAIL}decision=SESSION;if(lastSessionFilter instanceof SessionVariableFilter){if(runLastSessionFilterIfPresent){for(var c=0;c<sessionFiltersToRun.length;c++){try{sessionFiltersToRun[c].runTag(tag)}catch(ex){}}}}}if(tag.config.dedupe&&decision===PASS){if(lastUnmatched&&lastUnmatched instanceof SessionVariableFilter){tag.sendDedupePing=true;decision=FAIL}}return decision};TagsUtils.injectHTML=function(location,append,html,callback){return HtmlInjector.inject(location,(!append)?1:0,html,callback||EMPTY_FUN)};TagsUtils.getHTMLLocationForTag=function(tag){var el;var name=tag.prepareLocationObject(tag.config.locationObject);switch(name){case"HEAD":el=document.getElementsByTagName("head")[0];break;case"BODY":el=document.body;break;default:if(name){el=document.getElementById(name)}else{el=document.body}}return el}})();(function(){var Utils=qubit.opentag.Utils;var BV_COUNTER=0;function BaseVariable(config){this.config={};this.parameters=null;if(config){this.uniqueId="BV"+BV_COUNTER++;BaseVariable.ALL_VARIABLES[this.uniqueId]=this;for(var prop in config){this.config[prop]=config[prop]}if(config.value!==undefined){this.value=config.value}if(config.defaultValue!==undefined){this.defaultValue=config.defaultValue}var ret=BaseVariable.register(this);if(ret&&ret!==this){}return ret}}qubit.Define.clazz("qubit.opentag.pagevariable.BaseVariable",BaseVariable);BaseVariable.ALL_VARIABLES={};BaseVariable.pageVariables=[];BaseVariable.register=function(variable){if(variable instanceof BaseVariable){for(var i=0;i<BaseVariable.pageVariables.length;i++){var regVar=BaseVariable.pageVariables[i];if((variable.constructor===regVar.constructor)&&(propertiesMatch(regVar.config,variable.config))){return regVar}}BaseVariable.pageVariables.push(variable);return variable}return null};function propertiesMatch(cfg,ccfg){for(var cprop in ccfg){var value=ccfg[cprop];for(var prop in cfg){if(cfg.hasOwnProperty(prop)){if(cfg[prop]!==value){return false}}}}return true}BaseVariable.prototype.getValue=function(){return this.value};BaseVariable.prototype.setValue=function(string){this.value=string};BaseVariable.prototype.getDefaultValue=function(){return this.defaultValue
};BaseVariable.prototype.setDefaultValue=function(string){this.defaultValue=string};BaseVariable.prototype.exists=function(useDefaults){var exists=Utils.variableExists(this.getValue());if(useDefaults){exists=exists||Utils.variableExists(this.getDefaultValue())}return exists};BaseVariable.prototype.getRelativeValue=function(useDefaults,defaultValue){var pageValue=this.getValue();if(!Utils.variableExists(pageValue)){pageValue=defaultValue}var defLoc;if(useDefaults&&!Utils.variableExists(pageValue)){defLoc=this.getDefaultValue();if(Utils.variableExists(defLoc)){pageValue=defLoc}}return pageValue};BaseVariable.prototype.replaceToken=function(token,string,altValue,useExpressionAccessor){var exists=this.exists();var value=exists?this.getValue():altValue;token="\\$\\{"+token+"\\}";if((useExpressionAccessor||(value instanceof Array))){var acessorString;if(exists){acessorString=this.getValueAccessorString()}else{acessorString=Utils.getAnonymousAcessor(value)}return string.replace(new RegExp(token,"g"),acessorString)}else{return string.replace(new RegExp(token,"g"),value)}};BaseVariable.prototype.getAccessorString=function(){return"qubit.opentag.pagevariable.BaseVariable.ALL_VARIABLES."+this.uniqueId};BaseVariable.prototype.getValueAccessorString=function(){return this.getAccessorString()+".getValue()"}}());(function(){var Utils=qubit.opentag.Utils;var Timed=qubit.opentag.Timed;function Expression(config){this._lockExprObject={};Expression.superclass.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.Expression",Expression,qubit.opentag.pagevariable.BaseVariable);Expression.prototype.getValue=function(){var ret;var error;try{if(this.value.indexOf("[#]")===-1){var tmp=Utils.gevalAndReturn(this.value);ret=tmp.result;this.failMessage=null;error=tmp.error}else{ret=Expression.parseUVArray(this.value)}}catch(e){error=e}if(error){var msg="could not read value of expression: \n"+this.value+"\nexact cause: "+error;if(this.failMessage!==msg){this.failMessage=msg}ret=null}return ret};Expression.parseUVArray=function(uv){var parts=uv.split("[#]");var array=Utils.gevalAndReturn(parts[0]).result;var collection=[];var pathOfElements=parts[1];if(pathOfElements.indexOf(".")===0){pathOfElements=pathOfElements.replace(".","")}for(var i=0;i<array.length;i++){var element=Utils.getObjectUsingPath(pathOfElements,array[i]);collection.push(element)}return collection};Expression.prototype.replaceToken=function(token,string,altValue,exp){if((this.getValue() instanceof Array)){exp=true}return Expression.superclass.prototype.replaceToken.call(this,token,string,altValue,exp)}}());(function(){var Utils=qubit.opentag.Utils;function DOMText(config){DOMText.superclass.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.DOMText",DOMText,qubit.opentag.pagevariable.BaseVariable);DOMText.prototype.getValue=function(){return Utils.getElementValue(this.value)}}());(function(){var Timed=qubit.opentag.Timed;function Cookie(config){Cookie.superclass.apply(this,arguments);this._lockObject={}}qubit.Define.clazz("qubit.opentag.pagevariable.Cookie",Cookie,qubit.opentag.pagevariable.BaseVariable);Cookie.prototype.getValue=function(){var val=qubit.Cookie.get(this.value);Timed.maxFrequent(function(){}.bind(this),2000,this._lockObject);return val}}());(function(){var Utils=qubit.opentag.Utils;function URLQuery(config){URLQuery.superclass.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.URLQuery",URLQuery,qubit.opentag.pagevariable.BaseVariable);URLQuery.prototype.getValue=function(){return Utils.getQueryParam(this.value)}}());(function(){var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var BaseVariable=qubit.opentag.pagevariable.BaseVariable;var Expression=qubit.opentag.pagevariable.Expression;var DOMText=qubit.opentag.pagevariable.DOMText;var Cookie=qubit.opentag.pagevariable.Cookie;var URLQuery=qubit.opentag.pagevariable.URLQuery;function TagHelper(){}qubit.Define.clazz("qubit.opentag.TagHelper",TagHelper);TagHelper.injectHTMLForLoader=function(tag,callback,tryWrite,altHtml){var config=tag.config;var html=(altHtml!==undefined)?altHtml:config.html;if(html){var append=(config.locationPlaceHolder==="END");var location=TagsUtils.getHTMLLocationForTag(tag);tag.injectHTMLNotFinished=true;try{if(location){TagsUtils.injectHTML(location,append,html,function(){tag.injectHTMLNotFinished=false;if(callback){try{callback()}catch(e){}}}.bind(tag))}else{if(tryWrite&&document.readyState==="loading"){document.write(html);tag.injectHTMLNotFinished=false}else{tag.injectHTMLFailed=new Date().valueOf()}}}catch(ex){tag.injectHTMLNotFinished=false;tag.injectHTMLFailed=new Date().valueOf()}}};function findParamatersForVariable(tag,varRef){var ret=[];try{var params=tag.parameters;if(params){for(var i=0;i<params.length;i++){if(params[i].variable===varRef){ret.push(params[i])}}}}catch(ex){}return ret}TagHelper.getAllVariablesWithParameters=function(tag){var vars=tag.getPageVariables();var results=[];for(var i=0;i<vars.length;i++){var pageVar=vars[i];var parameters=findParamatersForVariable(tag,pageVar);for(var j=0;j<parameters.length;j++){results.push({parameter:parameters[j],variable:pageVar})}}return results};var _lock_obj={};TagHelper.allParameterVariablesReadyForTag=function(tag,tryDefaults){var useDefaults=tryDefaults;var log=tag.log;var allReady=true;var vars=tag.getPageVariables();for(var i=0;i<vars.length;i++){var pageVar=vars[i];try{var parameters=findParamatersForVariable(tag,pageVar);var exist=pageVar.exists();if(!exist&&useDefaults){if(parameters.length>0){exist=!!parameters[0].defaultValue}exist=exist||pageVar.exists(true)}if(!exist){allReady=false;break}}catch(ex){allReady=false;break}}return allReady};var JS_VALUE="2";var QUERY_PARAM="3";var COOKIE_VALUE="4";var ELEMENT_VALUE="5";TagHelper.validateAndGetVariableForParameter=function(param){if(param.hasOwnProperty("variable")&&param.variable){param.variable=TagHelper.initPageVariable(param.variable)}else{if(param.uv){param.variable=new Expression({name:param.uv,value:param.uv})}else{param.variable=TagHelper.initPageVariable({value:undefined,empty:true})}}return param.variable};TagHelper.initPageVariable=function(cfg){if(!cfg||cfg instanceof BaseVariable){return cfg}switch(cfg.type){case JS_VALUE:return new Expression(cfg);case QUERY_PARAM:return new URLQuery(cfg);case COOKIE_VALUE:return new Cookie(cfg);case ELEMENT_VALUE:return new DOMText(cfg);case"EPRESSION":return new Expression(cfg);case"URL_PARAMETER":return new URLQuery(cfg);case"COOKIE_VALUE":return new Cookie(cfg);case"DOM_VALUE":return new DOMText(cfg);default:return new BaseVariable(cfg)}}}());(function(){var Define=qubit.Define;var Utils=qubit.opentag.Utils;function Events(config){this.calls={}}Events.prototype.on=function(name,call){this.calls[name]=this.calls[name]||[];return Utils.addToArrayIfNotExist(this.calls[name],call)};Events.prototype.call=function(name){var calls=this.calls[name];if(calls){for(var i=0;i<calls.length;i++){try{calls[i]()}catch(ex){}}}};Events.prototype.remove=function(name,call){return Utils.removeFromArray(this.calls[name],call)};Events.prototype.removeAll=function(call){var total=0;for(var prop in this.calls){if(this.calls.hasOwnProperty(prop)){total+=Utils.removeFromArray(this.calls[prop],call)}}return total};Define.clazz("qubit.Events",Events)})();(function(){var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var TagHelper=qubit.opentag.TagHelper;var nameCounter=0;function GenericLoader(config){this.urlsLoaded=0;this.urlsFailed=0;this.events=new qubit.Events({});this._depLoadedHandler=function(){if(this.dependenciesLoaded()&&this.awaitingDependencies){this._triggerLoadingAndExecution()}}.bind(this);this.config={name:"Tag-"+nameCounter++,async:true,usesDocumentWrite:false,timeout:this.LOADING_TIMEOUT,dependencies:[],url:null,urlLocation:null,locationPlaceHolder:"END",locationObject:null,dontWaitForInjectionLocation:false,noMultipleLoad:false,loadDependenciesOnLoad:false};
this.delayDocWrite=false;this.dependencies=[];this._lockObject={count:0};this._lockObjectDepsLoaded={};this.genericDependencies=this.genericDependencies||[];if(config){if(!config.name){var n="Tag-"+nameCounter++;this.config.name=n}this.addState("INITIAL");for(var prop in config){this.config[prop]=config[prop]}if(config.genericDependencies){this.genericDependencies=this.genericDependencies.concat(config.genericDependencies)}if(config.dependencies){var deps=config.dependencies.concat(this.getDependencies());this.setDependencies(deps)}if(config.PACKAGE){this._package=config.PACKAGE}this.onInit()}}qubit.Define.clazz("qubit.opentag.GenericLoader",GenericLoader);GenericLoader.prototype.onInit=EMPTY_FUN;GenericLoader.prototype.LOADING_TIMEOUT=5*1000;GenericLoader.prototype._executeScript=function(){var success=false;try{this.script();success=true}catch(ex){this.addState("EXECUTED_WITH_ERRORS");this.executedWithErrors=new Date().valueOf();this._onError(ex)}finally{this._onExecute(success)}};GenericLoader.prototype.getTimeout=function(){return this._getTimeout()};GenericLoader.prototype._getTimeout=function(chain){var tout=+this.config.timeout;var deps=this.getDependencies();if(tout!==-1&&deps.length>0){var max=0;chain=chain||[];var present=(Utils.indexInArray(chain,this)!==-1);if(!present){chain[chain.length]=this;for(var i=0;i<deps.length;i++){var val=deps[i]._getTimeout(chain);if(val>max){max=val}}if(max>0){tout+=max}}else{return 0}}return tout};GenericLoader.prototype._onExecute=function(noErrors){this.onExecute(noErrors)};GenericLoader.prototype.onExecute=EMPTY_FUN;GenericLoader.prototype._flushDocWrites=function(cb){var ret=true;this._docWriteNotFlushed=false;try{var loc=TagsUtils.getHTMLLocationForTag(this);if(loc&&this._securedWrites&&this._securedWrites.length>0){var append=(this.config.locationPlaceHolder==="END");ret=TagsUtils.flushDocWritesArray(this._securedWrites,loc,append,this.log,cb);if(ret){this._docWriteFlushed=new Date().valueOf()}else{this._docWriteNotFlushed=new Date().valueOf()}}}catch(ex){this._onError(ex)}if(cb){cb()}if(this._securedWrites&&this._securedWrites.length>0){ret=false;this._docWriteNotFlushed=new Date().valueOf()}return ret};GenericLoader.prototype.log=EMPTY_FUN;GenericLoader.prototype.finished=function(){return !!this.runIsFinished};GenericLoader.prototype.script=function(){};GenericLoader.prototype.before=function(){this.beforeRun=new Date().valueOf();try{this.onBefore()}catch(ex){this._onError(ex)}};GenericLoader.prototype.onBefore=EMPTY_FUN;GenericLoader.prototype.after=function(success){this.afterRun=new Date().valueOf();try{this.onAfter(success)}catch(ex){this._onError(ex)}};GenericLoader.prototype.onAfter=function(success){};GenericLoader.prototype.runOnce=function(){if(!this._runOnceTriggered&&!this.scriptExecuted){this._runOnceTriggered=new Date().valueOf();this.run()}else{}};GenericLoader.CANCEL_ALL=false;GenericLoader.prototype.runCounter=0;GenericLoader.prototype.run=function(){if(this.cancelled||GenericLoader.CANCEL_ALL){this._handleCancel();return false}if(this.isRunning){return false}if(this.lastRun){this.reset()}this.lastRun=this.isRunning=new Date().valueOf();this.runCounter++;this._ignoreDeps=!!this.ignoreDependencies;if(!this._ignoreDeps&&!this.dependenciesLoaded()){this._attachDepsEventsToContinue();return false}return this._triggerLoadingAndExecution()};GenericLoader.prototype._triggerLoadingAndExecution=function(){this.awaitingDependencies=-new Date().valueOf();this.load();if(this._ignoreDeps){this.execute()}else{this.waitForDependenciesAndExecute()}return true};GenericLoader.prototype._attachDepsEventsToContinue=function(){this.awaitingDependencies=new Date().valueOf();var deps=this.getDependencies();for(var i=0;i<deps.length;i++){try{deps[i].events.on("success",this._depLoadedHandler)}catch(ex){}}};GenericLoader.prototype.dependenciesLoaded=function(){var deps=this.getDependencies();for(var i=0;i<deps.length;i++){if(deps[i]!==this){var executed=(+deps[i].scriptExecuted)>0;if(!executed){return false}}}return true};GenericLoader.prototype._setTimeout=function(fun,time){this._wasTimed=new Date().valueOf();return Timed.setTimeout(fun,time)};GenericLoader.prototype._handleCancel=function(){this.addState("CANCELLED");try{this.onCancel()}catch(ex){this._onError(ex)}};GenericLoader.prototype.waitForDependenciesAndExecute=function(){if(this.cancelled){this._handleCancel();return}if(this.loadedDependencies){this.execute()}else{if(this.loadingDependenciesFailed){this._markFailure();this._markFinished()}else{this._setTimeout(this.waitForDependenciesAndExecute.bind(this),30)}}};GenericLoader.prototype.execute=function(){this._triggerExecution()};GenericLoader.prototype._triggerExecution=function(){if(this.cancelled){this._handleCancel();return}if(this.scriptExecuted){return}var finished=true;if(this.shouldWaitForDocWriteProtection()){finished=false}else{if(!this._beforeEntered){this._beforeEntered=new Date().valueOf();var cancel=false;try{cancel=this.before()}catch(ex){this._onError(ex)}if(cancel){this._markFailure();this._markFinished();return}}finished=this.loadExecutionURLsAndHTML(this._triggerExecution.bind(this))}if(this.scriptExecuted){return}if(this.unexpectedFail){finished=true}if(!finished){this._setTimeout(this._triggerExecution.bind(this),30)}else{this._flushDocWrites();if(this.scriptLoadingFailed||this.injectHTMLFailed||this.unexpectedFail){this._markFailure()}else{this.scriptExecuted=new Date().valueOf();this.addState("EXECUTED");this._executeScript()}if(this.cancelled){this._handleCancel();return false}else{var successful=this.scriptExecuted>0;try{if(!this.afterRun){this.afterRun=new Date().valueOf();this.after(successful)}}catch(ex){this.executedWithErrors=new Date().valueOf()}if(!this.executedWithErrors){if(successful){this.events.call("success")}}}this._flushDocWrites();this._markFinished()}};GenericLoader.prototype._markFailure=function(){this.scriptExecuted=-(new Date().valueOf());this.addState("FAILED_TO_EXECUTE")};GenericLoader.prototype._markFinished=function(){this.runIsFinished=new Date().valueOf();this.isRunning=false;if(GenericLoader.LOCK_DOC_WRITE===this){this._flushDocWrites();TagsUtils.unlockDocumentWrites();GenericLoader.LOCK_DOC_WRITE=false}this.onFinished(true)};GenericLoader.prototype.onFinished=EMPTY_FUN;GenericLoader.prototype.onCancel=EMPTY_FUN;GenericLoader.prototype.onFinished=EMPTY_FUN;GenericLoader.prototype.shouldWaitForDocWriteProtection=function(){if(this.willSecureDocumentWrite()){if(!GenericLoader.LOCK_DOC_WRITE){GenericLoader.LOCK_DOC_WRITE=this;this._secureWriteAndCollectForExecution()}else{if(GenericLoader.LOCK_DOC_WRITE!==this){if(!this._lockedDocWriteInformed){this._lockedDocWriteInformed=new Date().valueOf()}return true}}}return false};GenericLoader.prototype.runWithoutDependencies=function(){this.ignoreDependencies=true;this.run()};GenericLoader.prototype.loadExecutionURLsAndHTML=function(callback){if(this.cancelled){this._handleCancel();return true}if(!this._loadExecutionURLsAndHTMLInformed){this._loadExecutionURLsAndHTMLInformed=true}this._triggerURLsLoading(callback);if(!this.loadURLsNotFinished){this._flushDocWrites();this._triggerHTMLInjection();this._flushDocWrites();if(!this.injectHTMLNotFinished){this._flushDocWrites();if(!this._docWriteNotFlushed){if(this._docWriteFlushed){}return true}}}return false};GenericLoader.prototype._triggerURLsLoading=function(callback){if(!this._urlLoadTriggered&&this.config.url){this._urlLoadTriggered=true;this.loadURLs(false,callback)}};GenericLoader.prototype._triggerHTMLInjection=function(){if(!this._injectHTMLTriggered&&this.config.html){this._injectHTMLTriggered=true;this.injectHTML()}};GenericLoader.prototype.STATE={INITIAL:0,STARTED:1,LOADING_DEPENDENCIES:2,LOADED_DEPENDENCIES:4,LOADING_URL:8,LOADED_URL:16,EXECUTED:32,EXECUTED_WITH_ERRORS:64,FAILED_TO_LOAD_DEPENDENCIES:128,FAILED_TO_LOAD_URL:256,FAILED_TO_EXECUTE:512,TIMED_OUT:1024,UNEXPECTED_FAIL:2048,CANCELLED:2048*2};GenericLoader.prototype.addState=function(stateName){if(this.STATE.hasOwnProperty(stateName)){this.state=(this.state|this.STATE[stateName]);
try{this.onStateChange(stateName)}catch(ex){this._onError(ex)}}};GenericLoader.prototype.onStateChange=EMPTY_FUN;GenericLoader.prototype.cancel=function(){this.cancelled=new Date().valueOf()};GenericLoader.prototype.state=GenericLoader.prototype.STATE.INITIAL;GenericLoader.prototype._markLoadedSuccesfuly=function(){this.loadedDependencies=new Date().valueOf();this.onAllDependenciesLoaded()};GenericLoader.prototype._secureWriteAndCollectForExecution=function(){if(!this._securedWrites){this._securedWrites=[];TagsUtils.redirectDocumentWritesToArray(this._securedWrites,this.log)}};function _waitForDependencies(){if(this.cancelled){this._handleCancel();return}this.waitForDependenciesFinished=new Date().valueOf();var fullBodyNeededAndUnLoaded=this._fullBodyNeededAndUnLoaded();var interactiveBodyNeededButNotReady=this._bodyNeededButNotAvailable();if(fullBodyNeededAndUnLoaded||interactiveBodyNeededButNotReady){this.waitForDependenciesFinished=false}else{if(!this.timeoutCountdownStart){this.timeoutCountdownStart=new Date().valueOf()}if(this.allDependenciesLoaded()){this._markLoadedSuccesfuly()}else{if(this._loadingOutOfTimeFrames()){this.loadingTimedOut=new Date().valueOf();if(this.allDependenciesLoaded(true)){this._markLoadedSuccesfuly()}else{this.addState("TIMED_OUT");this.loadingDependenciesFailed=new Date().valueOf();this._triggerOnLoadTimeout()}}else{this.waitForDependenciesFinished=false}}}if(!this.waitForDependenciesFinished){this._setTimeout(_waitForDependencies.bind(this),65)}else{this.addState("LOADED_DEPENDENCIES")}}GenericLoader.prototype.allDependenciesLoaded=function(tryDefaults,arrayToAdd){return this.getDependenciesToBeLoaded(tryDefaults,arrayToAdd).length===0};GenericLoader.prototype.getDependenciesToBeLoaded=function(tryDefaults,arrayToAdd){var failures=arrayToAdd||[];if(!this.injectionLocationReady()){failures.push("injection location")}var i;var deps=this.getDependencies();for(i=0;i<deps.length;i++){if(deps[i]!==this){var executed=(+deps[i].scriptExecuted)>0;if(!executed){var name=deps[i].config?deps[i].config.name:"anonymous";failures.push("dependant Tag with name -> "+name)}}}for(i=0;i<this.genericDependencies.length;i++){var ready=this.genericDependencies[i](this);if(!ready){failures.push("this.genericDependencies["+i+"] (index: "+i+")")}}if(failures!==""){}return failures};GenericLoader.prototype.docWriteAsksToWaitForBody=function(){return !!(this.delayDocWrite&&this.config.usesDocumentWrite)};GenericLoader.prototype._bodyNeededButNotAvailable=function(){if(this._dontWaitForInjections()){return false}return this._isBodyLocationNeeded()&&!TagsUtils.bodyAvailable()};GenericLoader.prototype._isBodyLocationNeeded=function(){if(!this.isLoadingAsynchronously()){return false}if(this._isBodyLocationSet()){return true}else{var atHead=(this.config.locationObject==="HEAD");return atHead&&(this.config.locationPlaceHolder==="END")}};GenericLoader.prototype._isBodyLocationSet=function(){var locObj=this.config.locationObject;return !locObj||(locObj==="BODY")};GenericLoader.prototype._fullBodyNeededAndUnLoaded=function(){if(this._dontWaitForInjections()){return false}var needed=false;if(this._isBodyLocationNeeded()){needed=(this.config.locationPlaceHolder==="END")}needed=needed||(this.fullbodyNeeded||this.docWriteAsksToWaitForBody());return needed&&!Utils.bodyReady()};GenericLoader.prototype._dontWaitForInjections=function(){return this.config.dontWaitForInjectionLocation||this.dontWaitForInjectionLocation||GenericLoader.dontWaitForInjectionLocation};GenericLoader.prototype.injectionLocationReady=function(){if(this._dontWaitForInjections()){return true}if(this._fullBodyNeededAndUnLoaded()){return false}if(!this.isLoadingAsynchronously()){return true}return !!TagsUtils.getHTMLLocationForTag(this)};GenericLoader.prototype._loadingOutOfTimeFrames=function(){if(this.getTimeout()<0){return false}return(new Date().valueOf()-this.timeoutCountdownStart)>this.getTimeout()};GenericLoader.prototype.loadDependencies=function(){this._loadDependencies()};GenericLoader.prototype.getDependencies=function(){return this.dependencies};GenericLoader.prototype.setDependencies=function(deps){this.dependencies=deps};GenericLoader.prototype._loadDependencies=function(chain){chain=chain||[];var deps=this.getDependencies();var present=Utils.indexInArray(chain,this)!==-1;if(!present){chain[chain.length]=this;for(var i=0;i<deps.length;i++){deps[i].load(chain)}}};GenericLoader.prototype.onError=EMPTY_FUN;GenericLoader.prototype._onError=function(msg){try{this.onError(msg)}catch(ex){}};GenericLoader.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};GenericLoader.prototype.onLoadTimeout=EMPTY_FUN;GenericLoader.prototype.onScriptsLoadSuccess=EMPTY_FUN;GenericLoader.prototype.onScriptLoadError=EMPTY_FUN;GenericLoader.prototype.onAllDependenciesLoaded=EMPTY_FUN;GenericLoader.prototype.onBeforeLoad=EMPTY_FUN;GenericLoader.prototype.load=function(){if(this.loadStarted){return}else{this.loadStarted=new Date().valueOf();try{this.onBeforeLoad()}catch(ex){this._onError(ex)}}this.addState("LOADING_DEPENDENCIES");try{if(!this._ignoreDeps&&this.config.loadDependenciesOnLoad){this.loadDependencies()}}catch(ex){throw ex}_waitForDependencies.call(this)};GenericLoader.prototype._singleUrlLoadHandler=function(success,urls,callback){++this.urlsLoaded;if(!success){++this.urlsFailed}if(this.urlsLoaded===urls.length){this.loadURLsNotFinished=false;if(success&&this.urlsFailed===0){this.addState("LOADED_URL");this.urlsLoaded=new Date().valueOf();try{if(callback){callback(true)}}catch(ex){this._onError(ex)}finally{this.onScriptsLoadSuccess()}}else{var message="error loading urls. Failed "+this.urlsFailed;this._onError(message);this.addState("FAILED_TO_LOAD_URL");this.urlsLoaded=-new Date().valueOf();try{this.scriptLoadingFailed=true;if(callback){callback(false)}}catch(ex){this._onError(ex)}finally{this.onScriptLoadError(message)}}}};GenericLoader.prototype.loadURLs=function(urlz,callback){var urls=urlz||this.config.url;this.addState("LOADING_URL");try{if(urls&&!(urls instanceof Array)){urls=[urls]}for(var i=0;i<urls.length;i++){this.loadURLsNotFinished=true;var url=urls[i];url=this.prepareURL(url);this.loadURL(url,function(success){this._singleUrlLoadHandler(success,urls,callback)}.bind(this))}}catch(ex){this.loadURLsNotFinished=false;this.addState("UNEXPECTED_FAIL");this.unexpectedFail=new Date().valueOf();this._onError(ex)}};GenericLoader.prototype.prepareLocationObject=function(loc){return loc};GenericLoader.prototype.prepareURL=function(url){return url};GenericLoader.prototype.prepareHTML=function(html){return html};GenericLoader.prototype.loadURL=function(url,callback,location){var passedUrl=url;this.addState("LOADING_URL");TagsUtils.loadScript({onsuccess:function(){try{if(callback){callback(true)}}catch(ex){}}.bind(this),onerror:function(){try{if(callback){callback(false)}}catch(ex){}}.bind(this),url:passedUrl,node:location||this.config.urlLocation,async:this.isLoadingAsynchronously(),noMultipleLoad:this.config.noMultipleLoad})};GenericLoader.prototype.reset=function(){var u;this._injectHTMLTriggered=u;this._loadExecutionURLsAndHTMLInformed=u;this._lockedDocWriteInformed=u;this._runOnceTriggered=u;this._urlLoadTriggered=u;this.afterRun=u;this.beforeRun=u;this.filtersRunTriggered=u;this.injectHTMLFailed=u;this.loadStarted=u;this.loadURLsNotFinished=u;this.loadedDependencies=u;this.loadingDependenciesFailed=u;this.loadingTimedOut=u;this.runIsFinished=u;this.scriptExecuted=u;this.scriptLoadingFailed=u;this.delayDocWrite=u;this._securedWrites=u;this.state=0;this.unexpectedFail=u;this.urlsFailed=0;this.urlsLoaded=0;this.waitForDependenciesFinished=u;this.isRunning=u;this._lastRun=u;this.cancelled=u;this._beforeEntered=u;this.awaitingDependencies=u;this.timeoutCountdownStart=u;this.addState("INITIAL")};GenericLoader.prototype.isLoadingAsynchronously=function(){if(this._wasTimed){return true}return !!(this.config.async||this.forceAsynchronous)};GenericLoader.prototype.willSecureDocumentWrite=function(){return(this.config.usesDocumentWrite&&this.isLoadingAsynchronously())
};GenericLoader.prototype.injectHTML=function(callback){var tryWriteIfNoLocation=!this.docWriteAsksToWaitForBody();var html=this.prepareHTML(this.config.html);if(html){TagHelper.injectHTMLForLoader(this,callback,tryWriteIfNoLocation,html)}};GenericLoader.prototype.clone=function(){var clone=new GenericLoader(this.config);return clone}}());(function(){var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var BaseFilter=qubit.opentag.filter.BaseFilter;var GenericLoader=qubit.opentag.GenericLoader;var TagHelper=qubit.opentag.TagHelper;function BaseTag(config){var defaults={filterTimeout:(config&&config.filterTimeout)||this.FILTER_WAIT_TIMEOUT,PACKAGE:(config&&config.PACKAGE),dedupe:false,needsConsent:false,inactive:false,variables:null,runner:null,disabled:false,locked:false};Utils.setIfUnset(config,defaults);BaseTag.superclass.apply(this,arguments);this.namedVariables={};this.parameters=[];this.filters=[];this.session=null;if(config){this.addState("INITIAL");try{BaseTag.register(this)}catch(ex){}if(config.filters){for(var i=0;i<config.filters.length;i++){this.addFilter(config.filters[i])}}if(config.parameters){this.parameters=this.parameters.concat(config.parameters)}if(config.variables){for(var prop in config.variables){if(config.variables.hasOwnProperty(prop)){var param=this.getParameterByTokenName(prop);if(param){var variable=config.variables[prop];param.variable=variable;if(variable.defaultValue!==undefined){param.defaultValue=variable.defaultValue}if(variable.uv!==undefined){param.uv=variable.uv}}}}}if(config.locked){this.lock()}this.initPageVariablesForParameters();this.uniqueRefString=null;this.onTagInit()}}qubit.Define.clazz("qubit.opentag.BaseTag",BaseTag,GenericLoader);BaseTag.prototype.valueForToken=function(token,defaults){var param=this.getParameterByTokenName(token);if(param){if(defaults===undefined){if(this.loadingTimedOut){defaults=true}}return this.getParameterValue(param,defaults)}if(this.namedVariables&&this.namedVariables[token]){var variable=_getSetNamedVariable(this,token);if(variable){return variable.getRelativeValue(defaults)}}return undefined};BaseTag.prototype.LOADING_TIMEOUT=5*1000;BaseTag.prototype.FILTER_WAIT_TIMEOUT=-1;BaseTag.prototype.run=function(){if(this.config.runner){var ret=false;try{this.addState("AWAITING_CALLBACK");ret=this._runner=new Date().valueOf();this.config.runner.call(this)}catch(e){}return ret}else{this._runner=false;return this.start()}};BaseTag.prototype.lock=function(){this.locked=true;this._unlock=null};BaseTag.prototype.unlock=function(){this.locked=false;if(this._unlock){this._unlock();this._unlock=false}};BaseTag.prototype.start=function(){if(!this.locked){return BaseTag.superclass.prototype.run.call(this)}else{this._unlock=function(){return BaseTag.superclass.prototype.run.call(this)}.bind(this);return false}};BaseTag.prototype.startOnce=function(){if(!this.locked){return BaseTag.superclass.prototype.runOnce.call(this)}else{this._unlock=function(){return BaseTag.superclass.prototype.runOnce.call(this)}.bind(this);return false}};BaseTag.prototype.getFilters=function(){return this.filters};BaseTag.prototype.runOnceIfFiltersPass=function(){if(!this._runOnceIfFiltersPassTriggered&&!this.scriptExecuted){this._runOnceIfFiltersPassTriggered=new Date().valueOf();this.runIfFiltersPass()}};BaseTag.prototype.runIfFiltersPass=function(){var state=this.filtersState(true);this.addState("FILTER_ACTIVE");if(!this.filtersRunTriggered){this.filtersRunTriggered=new Date().valueOf()}if(state===BaseFilter.state.SESSION){this.addState("AWAITING_CALLBACK");this.awaitingCallback=new Date().valueOf()}else{if(state===BaseFilter.state.PASS){this.filtersPassed=new Date().valueOf();try{this.onFiltersPassed()}catch(ex){}this.run()}else{if(state===BaseFilter.state.FAIL){this._markFiltersFailed();this._markFinished()}else{if(state>0){var tout=this.config.filterTimeout;if(tout<0||((new Date().valueOf()-this.filtersRunTriggered)>tout)){if(!this._awaitingForFilterInformed){this._awaitingForFilterInformed=new Date().valueOf();try{this.onFiltersDelayed()}catch(ex){}}this._setTimeout(this.runIfFiltersPass.bind(this),state)}else{this._markFiltersFailed();this._markFinished();this.filtersRunTimedOut=new Date().valueOf()}}}}}try{this.onFiltersCheck(state)}catch(e){}return state};BaseTag.prototype._markFiltersFailed=function(){this.addState("FILTERS_FAILED");this.filtersPassed=-(new Date().valueOf())};BaseTag.prototype.STATE={INITIAL:0,FILTER_ACTIVE:1,AWAITING_CALLBACK:2,FILTERS_FAILED:4,STARTED:8,LOADING_DEPENDENCIES:16,LOADED_DEPENDENCIES:32,LOADING_URL:64,LOADED_URL:128,EXECUTED:256,EXECUTED_WITH_ERRORS:512,FAILED_TO_LOAD_DEPENDENCIES:1024,FAILED_TO_LOAD_URL:2048,FAILED_TO_EXECUTE:4096,TIMED_OUT:4096*2,UNEXPECTED_FAIL:4096*2*2,CANCELLED:4096*2*2*2};BaseTag.prototype.addState=function(stateName){BaseTag.superclass.prototype.addState.call(this,stateName);try{BaseTag.onStateChange(this)}catch(ex){}this.stateStack=[];var s=this.STATE;var current=this.state;var stack=this.stateStack;if(current&s.INITIAL){stack.push("Initial state.")}if(current&s.FILTER_ACTIVE){stack.push("Tag running with filters pass triggered.")}if(current&s.FILTERS_FAILED){stack.push("Filters failed to pass.")}if(current&s.AWAITING_CALLBACK){stack.push("Awaiting callback to run this tag. Not pooling.")}if(current&s.STARTED){stack.push("Tag is initialized and loading has been started.")}if(current&s.LOADING_DEPENDENCIES){stack.push("Dependencies are being loaded.")}if(current&s.LOADED_DEPENDENCIES){stack.push("Dependencies loading process has been finished.")}if(current&s.LOADING_URL){stack.push("External URL is being loaded.")}if(current&s.LOADED_URL){stack.push("External URL has been loaded.")}if(current&s.EXECUTED){stack.push("Main script has been executed.")}if(current&s.EXECUTED_WITH_ERRORS){stack.push("Main script has been executed but errors occured.")}if(current&s.FAILED_TO_LOAD_DEPENDENCIES){stack.push("Dependencies has failed to load.")}if(current&s.FAILED_TO_LOAD_URL){stack.push("URL location failed to load.")}if(current&s.FAILED_TO_EXECUTE){stack.push("Script failed to execute.")}if(current&s.TIMED_OUT){stack.push("Script timed out awaiting for dependencies.")}if(current&s.UNEXPECTED_FAIL){stack.push("Script occured UNEXPECTED exception and is failed.")}if(current&s.CANCELLED){stack.push("Tag has been cancelled.")}};BaseTag.prototype.onTagInit=EMPTY_FUN;BaseTag.onStateChange=EMPTY_FUN;BaseTag.prototype.onFiltersDelayed=EMPTY_FUN;BaseTag.prototype.onFiltersPassed=EMPTY_FUN;BaseTag.prototype.onFiltersCheck=EMPTY_FUN;BaseTag.prototype.state=BaseTag.prototype.STATE.INITIAL;BaseTag.prototype.arePageVariablesLoaded=function(tryDefaults){return TagHelper.allParameterVariablesReadyForTag(this,tryDefaults)};BaseTag.prototype.getDependenciesToBeLoaded=function(tryDefaults,arrayToAdd){var failures=arrayToAdd||[];if(!this.arePageVariablesLoaded(tryDefaults)){failures.push("page variables")}return BaseTag.superclass.prototype.getDependenciesToBeLoaded.call(this,tryDefaults,failures)};BaseTag.prototype.prepareURL=function(url){return this.replaceTokensWithValues(url)};BaseTag.prototype.prepareLocationObject=function(loc){return this.replaceTokensWithValues(loc)};BaseTag.prototype.prepareHTML=function(html){if(html){html=this.replaceTokensWithValues(html)}return html};BaseTag.prototype._executeScript=function(){if(this.config&&this.config.script){if(typeof(this.config.script)==="function"){this.script=this.config.script}else{var expr=this.replaceTokensWithValues(String(this.config.script));this.script=Utils.expressionToFunction(expr).bind(this)}}BaseTag.superclass.prototype._executeScript.call(this)};BaseTag.prototype.replaceTokensWithValues=function(string){if(!string||string.indexOf("${")===-1){return string}var params=this.parameters;if(params){for(var i=0;i<params.length;i++){var parameter=params[i];var variable=this.getVariableForParameter(parameter);if(variable){var token=params[i].token;var value=this.valueForToken(token);
string=variable.replaceToken(token,string,value)}}}return string};BaseTag.prototype.getParameter=function(name){var params=this.parameters;var ret=null;if(params){for(var i=0;i<params.length;i++){if(params[i].name===name){ret=params[i]}}}return ret};BaseTag.prototype.setParameterValueByTokenName=function(tokenName,variable){var param=this.getParameterByTokenName(tokenName);if(param!==null){param.variable={value:variable};return true}return false};BaseTag.prototype.getParameterValue=function(parameterOrName,defaults){var param=(typeof(parameterOrName)==="string")?this.getParameter(parameterOrName):parameterOrName;if(param){var variable=this.getVariableForParameter(param);if(variable){try{var value;if(defaults){value=Utils.gevalAndReturn(param.defaultValue).result}value=variable.getRelativeValue(defaults,value);return value}catch(ex){return undefined}}}return undefined};BaseTag.prototype.filtersState=function(runLastSessionFIlterIfPresent){var run=runLastSessionFIlterIfPresent;return TagsUtils.filtersState(this.filters,this.session,this,run)};BaseTag.prototype.addFilter=function(filter){if(this.session){filter.setSession(this.session)}this.filters.push(filter)};BaseTag.prototype.reset=function(){BaseTag.superclass.prototype.reset.call(this);this.resetFilters();var u;this.filtersPassed=u;this.dedupePingSent=u;this.pingSent=u;this._runOnceIfFiltersPassTriggered=u;this.filtersRunTriggered=u;this._runner=u};BaseTag.prototype.resetFilters=function(){for(var i=0;i<this.filters.length;i++){this.filters[i].reset()}};BaseTag.prototype.getParameterByTokenName=function(name){var ret=null;if(this.parameters){var params=this.parameters;for(var i=0;i<params.length;i++){if(params[i].token===name){ret=params[i]}}}return ret};BaseTag.prototype.removeFilter=function(filter){Utils.removeFromArray(this.filters,filter)};var _counter_tag_map=0;var tags=[];var tagAccessorsMap={};var UNIQUE_REF={};BaseTag.register=function(tag){var index=Utils.addToArrayIfNotExist(tags,tag);if(index!==-1){}if(index===-1){tag._tagIndex=tags.length-1}else{tag._tagIndex=index}if(tag.config.id){var str="Q"+tag.config.id;UNIQUE_REF[str]=tag;tag.uniqueId=str}};BaseTag.getById=function(id){return UNIQUE_REF[String(id)]};BaseTag.prototype.getById=BaseTag.getById;BaseTag.prototype.unregister=function(ref){BaseTag.unregister(ref||this)};BaseTag.unregister=function(tag){var index=Utils.removeFromArray(tags,tag);if(!index||index.length===0){}tag._tagIndex=-1};BaseTag.getTags=function(){return tags};BaseTag.getAccessorsMap=function(){return tagAccessorsMap};BaseTag.prototype.getTags=function(){return tags};BaseTag.prototype.initPageVariablesForParameters=function(){var params=this.parameters;if(params){for(var i=0;i<params.length;i++){params[i].variable=TagHelper.validateAndGetVariableForParameter(params[i])}}if(this.namedVariables){for(var prop in this.namedVariables){if(this.namedVariables.hasOwnProperty(prop)){this.namedVariables[prop]=TagHelper.initPageVariable(this.namedVariables[prop])}}}};BaseTag.prototype.getPageVariables=function(){var params=this.parameters;var vars=[];if(params){for(var i=0;i<params.length;i++){var v=this.getVariableForParameter(params[i]);if(v!==null){Utils.addToArrayIfNotExist(vars,v)}}}if(this.namedVariables){for(var key in this.namedVariables){Utils.addToArrayIfNotExist(vars,_getSetNamedVariable(this,key))}}return vars};BaseTag.prototype.getAccessorString=function(){if(!this._accessorsMapKey){this._accessorsMapKey="_"+_counter_tag_map++;tagAccessorsMap[this._accessorsMapKey]=this}return"qubit.opentag.BaseTag.getAccessorsMap()."+this._accessorsMapKey};BaseTag.prototype.getVariableForParameter=function(param){var variable=TagHelper.validateAndGetVariableForParameter(param);var existAndIsNotEmpty=variable&&!variable.config.empty;if(!existAndIsNotEmpty&&(this.namedVariables&&this.namedVariables[param.token])){variable=_getSetNamedVariable(this,param.token)}return variable};BaseTag.prototype.checkVariablesState=function(){var res=[];var pairs=TagHelper.getAllVariablesWithParameters(this);for(var i=0;i<pairs.length;i++){var param=pairs[i].parameter;var variable=pairs[i].variable;var val;if(param&&param.token){val=this.valueForToken(param.token)}else{val=variable.getRelativeValue(true)}var tmp={name:variable.config.name,exists:variable.exists(),token:param?param.token:null,value:val,variable:variable};res.push(tmp)}return res};BaseTag.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};function _getSetNamedVariable(tag,token){var variable=TagHelper.initPageVariable(tag.namedVariables[token]);tag.namedVariables[token]=variable;return variable}BaseTag.prototype._getUniqueId=function(){var id=this.config.name;if(this.config.id){id=this.config.id}return id};var cookiePrefix="qubit.tag.forceRunning_";var cookieRunAll="qubit.tag.forceAllToRun";BaseTag.prototype.cookieSaysToRunEvenIfDisabled=function(){var id=this._getUniqueId();var ret=!!qubit.Cookie.get(cookieRunAll);if(!ret){ret=!!qubit.Cookie.get(cookiePrefix+id)}return ret};BaseTag.prototype.setCookieForcingTagToRun=function(){var id=this._getUniqueId();qubit.Cookie.set(cookiePrefix+id,"true")};BaseTag.setCookieForcingTagsToRun=function(){qubit.Cookie.set(cookieRunAll,"true")};BaseTag.rmCookieForcingTagsToRun=function(){qubit.Cookie.rm(cookieRunAll)};BaseTag.prototype.rmCookieForcingTagToRun=function(){var id=this._getUniqueId();qubit.Cookie.rm(cookiePrefix+id)};BaseTag.rmAllCookiesForcingTagToRun=function(){var cookies=qubit.Cookie.getAll();for(var i=0;i<cookies.length;i++){var name=cookies[i][0];if(name.indexOf(cookiePrefix)===0){qubit.Cookie.rm(name)}}BaseTag.rmCookieForcingTagsToRun()}}());(function(){var Tags=function(){};qubit.Define.clazz("qubit.opentag.Tags",Tags);Tags.getById=function(id){return qubit.opentag.BaseTag.getById(String(id))};Tags.getAllTagsByState=function(){return qubit.opentag.Container.getAllTagsByState(Tags.getTags())};Tags.findTagByName=function(match){var tags=this.getTags();var results=[];for(var i=0;i<tags.length;i++){if(tags[i].config.name===match){results.push(tags[i])}}return results};Tags.findTagByMatch=function(match){var tags=this.getTags();var results=[];for(var i=0;i<tags.length;i++){if(tags[i].config.name.match(match)){results.push(tags[i])}}return results};Tags.getTags=function(){return qubit.opentag.BaseTag.getTags()};Tags.resetAllTags=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].reset()}};Tags.getContainersPageVariables=function(){var containers=Tags.getContainers();var vars=[];for(var i=0;i<containers.length;i++){vars=vars.concat(containers.getPageVariables())}return vars};Tags.getAllPageVariables=function(){var tags=Tags.getTags();var vars=[];for(var i=0;i<tags.length;i++){vars=vars.concat(tags[i].getPageVariables())}return vars};Tags.cancelAll=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].cancel()}};Tags.resetAll=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].reset()}};Tags.getPageVariableByName=function(name){var vars=Tags.getAllPageVariables();var rets=[];for(var i=0;i<vars.length;i++){if(vars[i].config.name===name){rets.push(vars[i])}}return rets};Tags.getLoadTime=function(tag){var start=tag.beforeRun;var end=tag.runIsFinished;if(isNaN(end)){return{tag:tag,loadTime:null}}else{return{tag:tag,loadTime:(end-start)}}};Tags.getLoadTimes=function(tags){var ret=[];if(tags instanceof qubit.opentag.BaseTag){ret.push([Tags.getLoadTime(tags[prop])]);return ret}tags=tags||Tags.getTags();var array=tags instanceof Array;if(array){for(var i=0;i<tags.length;i++){if(tags[i] instanceof qubit.opentag.BaseTag){ret.push(Tags.getLoadTime(tags[i]))}}}else{for(var prop in tags){if(tags[prop] instanceof qubit.opentag.BaseTag){ret.push(Tags.getLoadTime(tags[prop]))}}}return ret};Tags.forceAllContainersAndTagsToRunIfDisabled=function(){qubit.opentag.Container.setCookieForDisabledContainersToRun();qubit.opentag.BaseTag.setCookieForcingTagsToRun()};Tags.rmAllContainersAndTagsForcingFlags=function(){qubit.opentag.Container.rmCookieForDisabledContainersToRun();
qubit.opentag.BaseTag.rmAllCookiesForcingTagToRun()};Tags.getContainers=function(){return qubit.opentag.Container.getContainers()}})();q.cookie={};q.cookie.PageView={};q.cookie.PageView.update=function(){var a,r;r=function _(){return(Math.floor(1+Math.random()*65536)).toString(36).substring(1)};if(!window.__pageViewId__){a=new Date().getTime().toString(36);window.__pageViewId__=a+r()+r()+r()}return window.__pageViewId__};q.html.PostData=function(url,data,type){var _post,agent,isIe,isIe9,isOldIe,fullUrl,loaded,retry,retryDelay,retryCount;retryCount=2;retryDelay=5000;loaded=false;retry=function(){if(retryCount>0){setTimeout(function(){if(!loaded){retryCount-=1;_post()}},retryDelay)}};agent=navigator.userAgent.toLowerCase();isIe=agent.indexOf("msie")!==-1;isIe9=agent.indexOf("msie 9")!==-1;isOldIe=((agent.indexOf("msie 7")!==-1)||(agent.indexOf("msie 6")!==-1));fullUrl=("https:"===document.location.protocol?"https:":"http:")+url;type=type||"POST";_post=function(){var xhr;try{xhr=null;try{xhr=new XMLHttpRequest()}catch(e1){}if(xhr&&!isIe){xhr.open(type,fullUrl,true)}else{if(typeof XDomainRequest!=="undefined"){xhr=new XDomainRequest();xhr.open(type,fullUrl)}else{xhr=null}}try{xhr.withCredentials=false}catch(e2){}if(xhr.setRequestHeader){xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8")}xhr.onload=function(){loaded=true};xhr.onreadystatechange=function(){};xhr.ontimeout=function(){};xhr.onerror=function(){};xhr.onprogress=function(){};xhr.send(data)}catch(err){try{try{q.html.fileLoader.load(fullUrl)}catch(err2){if(window.console&&window.console.log){window.console.log(err)}}}catch(e){}}retry()};if(isOldIe){q.html.fileLoader.load(fullUrl);return}else{_post()}};(function(){function Ping(){}qubit.Define.clazz("qubit.opentag.Ping",Ping);Ping.prototype.send=function(config,loadTimes){var pingString="c="+config.clientId+"&p="+config.containerId+"&l="+config.tellLoadTimesProbability+"&pv="+q.cookie.PageView.update()+"&d=";var pingStrings=[];for(var i=0;i<loadTimes.length;i++){var tag=loadTimes[i].tag;var loadTime=loadTimes[i].loadTime;if(loadTime===null||isNaN(loadTime)){continue}var loaderId=tag.config.id;if(!tag.pingSent&&loaderId&&loadTime!==null){if(loaderId!==undefined){pingStrings.push('"'+loaderId+'":'+loadTime);tag.pingSent=true}else{}}else{if(tag.pingSent){}else{if(loadTime===null){}}}}if(config.pingServerUrl&&pingStrings.length>0){pingString+=encodeURIComponent("{"+pingStrings.join(",")+"}");var url="//"+config.pingServerUrl+"/tag2?"+pingString;q.html.PostData(url,null,"GET")}else{if(!pingStrings.length){}if(!config.pingServerUrl){}}};Ping.prototype.sendErrors=function(config,errors){};Ping.prototype.sendDedupe=function(config,tags){var pingString="c="+config.clientId+"&p="+config.containerId+"&l="+(config.tellLoadTimesProbability)+"&pv="+q.cookie.PageView.update()+"&dd=";var pingStrings=[];for(var i=0;i<tags.length;i++){var tag=tags[i];var loaderId=tag.config.id;if(loaderId===undefined){}else{if(!tag.dedupePingSent){pingStrings.push(loaderId);tag.dedupePingSent=true}}}if(pingStrings.length>0&&config.pingServerUrl){pingString+=encodeURIComponent("["+pingStrings.join(",")+"]");q.html.PostData("//"+config.pingServerUrl+"/tag2?"+pingString,null,"GET")}else{if(!pingStrings.length){}if(!config.pingServerUrl){}}}}());q.cookie.SimpleSessionCounter={};q.cookie.SimpleSessionCounter._cookieName="_qst_s";q.cookie.SimpleSessionCounter._sessionCookie="_qsst_s";q.cookie.SimpleSessionCounter.update=function(domain){var c,s,ga,mins=30;c=qubit.Cookie.get(q.cookie.SimpleSessionCounter._cookieName);s=qubit.Cookie.get(q.cookie.SimpleSessionCounter._sessionCookie);if(!c){c=1}else{c=parseInt(c,10);if(!s||(parseInt(s,10)<(new Date().getTime()-mins*60*1000))){c+=1}}qubit.Cookie.set(q.cookie.SimpleSessionCounter._cookieName,c,365,domain);qubit.Cookie.set(q.cookie.SimpleSessionCounter._sessionCookie,new Date().getTime().toString(),null,domain);return c};var JSON={};(function(){function f(n){return n<10?"0"+n:n}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function stringifyDate(key){return isFinite(key.valueOf())?key.getUTCFullYear()+"-"+f(key.getUTCMonth()+1)+"-"+f(key.getUTCDate())+"T"+f(key.getUTCHours())+":"+f(key.getUTCMinutes())+":"+f(key.getUTCSeconds())+"Z":null}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=stringifyDate(value)}else{if((value instanceof String)||(value instanceof Number)||(value instanceof Boolean)){value=value.valueOf()}}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){try{partial[i]=str(i,value)||"null"}catch(stackExceeded){partial[i]='{"stack_exceeded": null}'}}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];try{v=str(k,value)}catch(stackExceeded){v='{"stack_exceeded": null}'}if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){try{v=str(k,value)}catch(stackExceeded){v='{"stack_exceeded": null}'}if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(){var defaultAlphabet=[];var len=Math.pow(2,8);for(var c=0;c<len;c++){defaultAlphabet.push(String.fromCharCode(c))}var xdict={};for(var i=0;i<defaultAlphabet.length;i++){xdict[defaultAlphabet[i]]=i}var Define=qubit.Define;function LZW(config){if(config){if(config.alphabet){this.alphabet=config.alphabet;this.dict={};for(var i=0;i<this.alphabet.length;i++){this.dict[this.alphabet[i]]=i}}else{this.alphabet=defaultAlphabet;this.dict=xdict}}}Define.clazz("qubit.compression.LZW",LZW);LZW.prototype.encode=function(string){var dictsize=this.alphabet.length;var extDict={};var results=[];var index=0;var curr=string.charAt(index++);var next;var dict=this.dict;
while(!!(next=string.charAt(index++))){var newWord=curr+next;if(dict.hasOwnProperty(newWord)||extDict.hasOwnProperty(newWord)){curr=newWord}else{var val=dict.hasOwnProperty(curr)?dict[curr]:extDict[curr];if(val===undefined){throw"Dictionary base is to small for those contents: "+curr}results.push(val);extDict[newWord]=dictsize++;curr=next}}if(curr!==""){results.push(extDict.hasOwnProperty(curr)?extDict[curr]:dict[curr])}return results};LZW.prototype.decode=function(codes){var dict=this.dict;var dictSize=this.alphabet.length;var chunk;var locdict={};var prevChar=getFromDict(codes[0],dict);var prevChunk=prevChar;var results=[prevChar];for(var i=1;i<codes.length;i++){var currentCode=codes[i];chunk=getFromDict(currentCode,dict);if(chunk===null){if(locdict.hasOwnProperty(currentCode)){chunk=locdict[currentCode]}if(chunk===null){chunk=prevChunk+prevChar}}results.push(chunk);prevChar=chunk.charAt(0);locdict[dictSize++]=prevChunk+prevChar;prevChunk=chunk}return results.join("")};function getFromDict(code,dict){for(var p in dict){if(code===dict[p]){return p}}return null}}());(function(){var mex="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[";var Umex='ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-+()@{|}"]^_`~$&#';var mexMap={};for(var c=0;c<mex.length;c++){mexMap[mex.charAt(c)]=c}var UmexMap={};for(var ii=0;ii<mex.length;ii++){UmexMap[Umex.charAt(ii)]=ii}var UmexToMexMap={};for(var iii=0;iii<mex.length;iii++){UmexToMexMap[mex.charAt(iii)]=Umex.charAt(iii)}var mnums=mex.split("");var maxMnum=mnums.length;function converToMex(number){var rest=0;var minus=number<0;if(minus){number=-number}var newNum="";var first=true;do{rest=number%maxMnum;if(first){newNum=UmexToMexMap[mnums[rest]];first=false}else{newNum=mnums[rest]+newNum}number=(number-rest)/maxMnum}while(number>0);if(minus){return"-"+newNum}return newNum}function convertFromMex(mexNum){var newNum=0;var pow=0;var first=true;for(var i=0;i<mexNum.length;i++){var cur=mexNum.charAt(mexNum.length-1-i);if(first){first=false;cur=mex.charAt(UmexMap[cur])}newNum+=mexMap[cur]*Math.pow(maxMnum,pow++)}return newNum}var lzw=new qubit.compression.LZW({});var Define=qubit.Define;function Compressor(config){}Define.clazz("qubit.compression.Compressor",Compressor);Compressor.prototype.compress=function(string,lz){var array=(lz||lzw).encode(string);var result=[];for(var i=0;i<array.length;i++){result.push(String.fromCharCode(array[i]))}return result.join("")};Compressor.prototype.compressAnsi=function(string,lz){var array=(lz||lzw).encode(string);var result=[];for(var i=0;i<array.length;i++){var num=converToMex(array[i]);result.push(num)}return result.join("")};Compressor.prototype.decompressAnsi=function(code,lz){var array=[];var curr="";for(var i=0;i<code.length;i++){var ch=code.charAt(i);if(UmexMap.hasOwnProperty(ch)){var num=curr+ch;curr="";num=convertFromMex(num);array.push(num)}else{curr+=ch}}return(lz||lzw).decode(array)};Compressor.prototype.decompress=function(code,lz){var array=[];for(var i=0;i<code.length;i++){array.push(code.charCodeAt(i))}return(lz||lzw).decode(array)}}());(function(){var Define=qubit.Define;var Cookie=qubit.Cookie;var definitions=[['","referrer":[{"url":"http://',"1-"],['","referrer":[{"url":"https://',"2-"],[',"referrer":[{"url":"http://',"3-"],[',"referrer":[{"url":"https://',"4-"],[',"sessionStartTime":',"5-"],["www.google.co.uk","6-"],["www.google.","7-"],['"sessionStartTime":',"8-"],['"landing":"',"9-"],["http%3A%2F%2Fwww","10-"],['"landing":',"L"],['"time":',"A"],['"pageViews":',"P"],['"sessionCount":',"B"],['"referrer":',"R"],['"url":"http://www.',"J"],['"url":"https://www.',"M"],['"url":"',"I"],['"url":',"U"],["http://www.","W"],["https://www.","V"],["%2Fen%2Ftsuk%2F","K"],['"sessionLandingPage":',"F"],["http%3A%2F%2F","D"],["http://","H"],["https://","X"],['""',"O"],['",',"Y"],['":{}}',"z"],["<","S"],[">","G"],["[","Z"],["]","E"],["{","a"],["}","b"],["(","c"],[")","d"],["!","e"],["#","f"],["$","g"],["!","q"],["'","i"],[":","j"],["?","k"],["^","x"],["`","m"],["|","n"],["~","o"],["%","v"],[",","C"]];function prepareDefinitions(array){var definitions=[];for(var i=0;i<array.length;i++){var preparedString=escapeRegExp(array[i][0]);definitions.push([new RegExp(preparedString,"g"),"*"+array[i][1]])}return definitions}function getDefinitionByChar(ch,definitions){for(var i=0;i<definitions.length;i++){if(definitions[i][1]===ch){return definitions[i][0]}}return null}var regexDefinitions=prepareDefinitions(definitions);function Encoder(config){this._regexDefs=regexDefinitions;this._defs=definitions;if(config){if(config.definitions){this._regexDefs=prepareDefinitions(config.definitions);this._defs=config.definitions}}}Define.clazz("qubit.opentag.compression.Encoder",Encoder);Encoder.prototype.encode=function encode(string,limitUTFRange){var ret=string.replace(/\*/g,"**");var ininitalDdict=dynamicDictionary(ret);for(var i=0;i<this._regexDefs.length;i++){var pair=this._regexDefs[i];ret=ret.replace(pair[0],pair[1])}ret=ret.replace(/;/g,"*-");ret=ret.replace(/&/g,"*.");ret=ret.replace(/\\/g,"*/");ret=ret.replace(/=/g,"*+");ret=ret.replace(/\n/g,"*N");ret=ret.replace(/ /g,"*_");ret=ret.replace(/\t/g,"*T");ret=ret.replace(/"/g,"*Q");var ddict=dynamicDictionary(ret);ddict.concat(ininitalDdict);var result=replaceWithDynamicDictionary(ddict,ret);var actualDict=result[1];var replacementsOccured=actualDict.length>0;if(replacementsOccured){ret=result[0]}if(!limitUTFRange){ret=replaceWithUTFEncoding(ret)}else{ret=replaceWithUTFEncoding(ret,limitUTFRange)}if(replacementsOccured){return"Y"+actualDict.join("*")+"@"+ret}else{return"N"+ret}};function replaceWithUTFEncoding(string,range){var rewrite=[];for(var i=0;i<string.length;i++){var inRange=true;if(range){inRange=string.charCodeAt(i)<=range}var inCookieAlphabet=Cookie.cookieAlphabetMap.hasOwnProperty(string.charAt(i));if(inRange&&!inCookieAlphabet){rewrite.push("*"+string.charCodeAt(i)+".")}else{rewrite.push(string.charAt(i))}}return rewrite.join("")}function replaceWithDynamicDictionary(ddict,string){string=string.replace(/@/g,"@@");var dict=[];for(var i=0,j=0;i<ddict.length;i++){var pattern=ddict[i][0];var rx=new RegExp(escapeRegExp(pattern),"g");var out=string.replace(rx,"@"+j+"-");if(out!==string){dict.push(ddict[i][0]);j++;string=out}}return[string,dict]}function escapeRegExp(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}var dynamicDictChars="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+_.";var dynamicDictCharsMap={};for(var i=0;i<dynamicDictChars.length;i++){dynamicDictCharsMap[dynamicDictChars.charAt(i)]=true}var MIN_WORD_LEN=4;var MIN_OCCURENCE_LEN=2;function dynamicDictionary(str){var parts={};var word="";for(var i=0;i<str.length;i++){var ch=str.charAt(i);if(!dynamicDictCharsMap[ch]){if(isNaN(parts[word])){parts[word]=str.split(word).length-1}word=""}else{word+=ch}}var dict=[];for(var prop in parts){if(parts.hasOwnProperty(prop)){var occurringNum=parts[prop];if(occurringNum>=MIN_OCCURENCE_LEN&&prop.length>=MIN_WORD_LEN){dict.push([prop,occurringNum])}}}dict=dict.sort(function(a,b){if(a[0].length===b[0].length){return 0}if(b[0].length>a[0].length){return 1}else{return -1}});return dict}Encoder.prototype.decode=function(string){var ddict=null;if(string.charAt(0)==="N"){string=string.substring(1)}else{if(string.charAt(0)==="Y"){var qMkIdx=string.indexOf("@");if(qMkIdx>=0){ddict=string.substring(1,qMkIdx);ddict=ddict.split("*");string=string.substring(qMkIdx+1);string=decodeDynamicDictionary(string,ddict)}}}var ret="";var codeWord=false;var collectingNum=false;var utfNum="";for(var i=0;i<string.length;i++){var ch=string.charAt(i);if(ch==="*"||codeWord||collectingNum){if(codeWord||collectingNum){codeWord=false;if(!isNaN(+("-"+ch))){utfNum=utfNum+ch;collectingNum=true}else{if(collectingNum){if(ch==="."){ret+=String.fromCharCode(+utfNum)}else{if(ch==="-"&&getDefinitionByChar(utfNum+"-",this._defs)){ret+=getDefinitionByChar(utfNum+"-",this._defs)}else{ret+="*"+utfNum+ch}}utfNum="";collectingNum=false}else{if(ch==="*"){ret+="*"}else{if(ch==="-"){ret+=";"
}else{if(ch==="/"){ret+="\\"}else{if(ch==="."){ret+="&"}else{if(ch==="+"){ret+="="}else{if(ch==="N"){ret+="\n"}else{if(ch==="_"){ret+=" "}else{if(ch==="T"){ret+="\t"}else{if(ch==="Q"){ret+='"'}else{if(getDefinitionByChar(ch,this._defs)!==null){var def=getDefinitionByChar(ch,this._defs);ret+=def}else{ret+="*"+ch}}}}}}}}}}}}}else{codeWord=true}}else{ret+=ch}}if(utfNum){ret+="*"+utfNum}if(codeWord){ret+="*"}return ret};function decodeDynamicDictionary(string,ddict){if(!ddict||ddict.length===0||!string){return string}var ret="";var codeWord=false;var collectingNum=false;var codeNum="";for(var i=0;i<string.length;i++){var ch=string.charAt(i);if(ch==="@"||codeWord||collectingNum){if(codeWord||collectingNum){codeWord=false;if(ch==="@"){ret+="@"}else{if(!isNaN(+("-"+ch))){collectingNum=true;codeNum=codeNum+ch}else{if(collectingNum){if(ddict&&ch==="-"&&ddict[+codeNum]){ret+=ddict[+codeNum]}else{ret+="@"+codeNum+ch}codeNum="";collectingNum=false}else{ret+="@"+ch}}}}else{codeWord=true}}else{ret+=ch}}if(codeNum){ret+="@"+codeNum}if(codeWord){ret+="@"}return ret}})();(function(){var Define=qubit.Define;var Cookie=qubit.Cookie;var binSupported=false;function CookieCompressor(config){this.testBinary=false;this.binSupported=binSupported;if(config){this.compressor=new qubit.compression.Compressor();this.encoder=new qubit.opentag.compression.Encoder({})}}Define.clazz("qubit.opentag.compression.CookieCompressor",CookieCompressor);CookieCompressor.prototype.compress=function(string,forceCompression){if(typeof(string)!=="string"||string===""){return string}var encoded=this.encoder.encode(string);var binOut;if(this.binSupported||this.testBinary){var bin=this.compressor.compress(encoded);binOut='"B'+this.encoder.encode(bin,128)+'"';Cookie.set("__qtag_test_bin__",binOut,undefined,undefined,true);var o=Cookie.get("__qtag_test_bin__",true);Cookie.rm("__qtag_test_bin__");if(o&&o!==binOut){binOut=null}}var ansiOut;var compressed=this.encoder.encode(this.compressor.compressAnsi(encoded));if((!forceCompression)&&encoded.length<=compressed.length){ansiOut="E"+encoded}else{ansiOut="C"+compressed}if(binOut&&binOut.length<ansiOut.length){return binOut}else{return ansiOut}};CookieCompressor.prototype.decompress=function(string){if(typeof(string)!=="string"||string===""){return string}if(string.charAt(0)==='"'){string=string.substring(1,string.length-1)}var code=string.charAt(0);string=string.substring(1);switch(code){case"E":return this.encoder.decode(string);case"C":var tmp=this.compressor.decompressAnsi(this.encoder.decode(string));return this.encoder.decode(tmp);case"B":var tmp1=this.compressor.decompress(this.encoder.decode(string));return this.encoder.decode(tmp1);default:throw"This code is not supported! Code: "+code}}})();(function(){var Cookie=qubit.Cookie;var Utils=qubit.opentag.Utils;var Session=function(){};qubit.Define.clazz("qubit.opentag.Session",Session);var compressor=new qubit.opentag.compression.CookieCompressor({});Session.readCompressedCookie=function(name){var cookie=Cookie.get(name,true);return compressor.decompress(cookie)};Session.setupSession=function(config){var session,i,cookie,cookieText,cookieName,now;session={};session.sessionCount=q.cookie.SimpleSessionCounter.update(config.cookieDomain);cookieName="qtag_"+config.containerId;var xCookieName="x_qtag_"+config.containerId;cookie=Cookie.get(cookieName);var nonCompressedCookie=!!cookie;if(cookie===null){cookie=Cookie.get(xCookieName,true);cookie=compressor.decompress(cookie)}if(cookie){try{cookie=JSON.parse(cookie)}catch(e){cookie={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}}}}else{cookie={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}}}now=new Date().getTime();if(session.sessionCount!==parseInt(cookie.sc,10)){cookie.sessionStartTime=now;cookie.sc=session.sessionCount;cookie.sessionCount+=1;cookie.referrer.push({url:Session.getReferrer(),landing:Utils.getUrl().substring(0,300),time:now});cookie.sessionLandingPage=Utils.getUrl().substring(0,300)}else{if(Session.isReferrerDifferent()){if(!Session.referrerIsSameAsPrevious(cookie.referrer,now,30*60*1000)){cookie.referrer.push({url:Session.getReferrer(),landing:Utils.getUrl().substring(0,300),time:now});cookie.sessionLandingPage=Utils.getUrl().substring(0,300);cookie.sessionStartTime=now;cookie.sessionCount+=1}}}session.sessionCount=cookie.sessionCount;session.sessionStartTime=cookie.sessionStartTime;session.pageStartTime=now;cookie.pageViews+=1;session.pageViews=cookie.pageViews;session.sessionLandingPage=cookie.sessionLandingPage;session.referrer=cookie.referrer;if(session.referrer.length>5){session.referrer.splice(2,session.referrer.length-5)}cookieText=JSON.stringify(cookie);i=0;while((compressor.compress(cookieText).length>config.maxCookieLength)&&(i<5)){if(cookie.referrer.length>=3){cookie.referrer.splice(2,1)}else{if(cookie.referrer.length===2){cookie.referrer=[cookie.referrer[0]]}else{if(cookie.referrer.length===1){cookie.referrer=[]}}}cookieText=JSON.stringify(cookie);i+=1}session.referrer=cookie.referrer;if(nonCompressedCookie){Cookie.rm(cookieName)}var xCookieText=compressor.compress(cookieText);Cookie.rm(xCookieName);if(config.maxCookieLength>0){Cookie.set(xCookieName,xCookieText,365,config.cookieDomain,true)}session.setVariable=function(key,value,time){var t=(!!time)?time:0;cookie.__v[key]=[value,t];var xCookieText=compressor.compress(JSON.stringify(cookie));if(config.maxCookieLength>0){Cookie.set(xCookieName,xCookieText,365,config.cookieDomain,true)}else{Cookie.rm(xCookieName)}};session.getCookie=function(name,compressed){var res=Cookie.get(name,true);if(res&&(compressed||name.indexOf("x_")===0)){try{res=compressor.decompress(res)}catch(ex){}}else{if(res!==null){res=Cookie.decode(res)}}return res};session.getVariable=function(key){var v,t,now;v=cookie.__v[key];if(v){t=v[1];if((t===0)||(t>new Date().getTime())){return v[0]}}return null};session.on=function(event,el,fn){if(el.attachEvent){el.attachEvent("on"+event,fn)}else{if(el.addEventListener){el.addEventListener(event,fn,false)}}};session.getTagCookie=function(){return Session.readCompressedCookie(xCookieName)};Session.lastSession=session;return session};Session.referrerIsSameAsPrevious=function(referrers,now,overlapDuration){var url,landing,lastReferrer;if(referrers.length>0){url=Session.getReferrer();landing=Utils.getUrl().substring(0,300);lastReferrer=referrers[referrers.length-1];return(lastReferrer.url===url)&&(lastReferrer.landing===landing)&&((lastReferrer.time+overlapDuration)>now)}return false};Session.isReferrerDifferent=function(){var start,end,ref;ref=Session.getReferrer();start=ref.indexOf("://");if(start===-1){return true}start+=3;try{if(ref.substring(start).indexOf(Session.getDomain())!==0){return true}return false}catch(ex){return true}};Session.getReferrer=function(){if(document.referrer){return document.referrer.substring(0,300)}return"direct"};Session.getDomain=function(){return document.location.host}}());(function(){var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var BaseTag=qubit.opentag.BaseTag;var Timed=qubit.opentag.Timed;var Tags=qubit.opentag.Tags;var Session=qubit.opentag.Session;var Cookie=qubit.Cookie;var _counter=1;try{window.opentag_consentGiven=function(){Container.consentIsGiven=true;var all=Container.getContainers();for(var i=0;i<all.length;i++){try{all[i].run()}catch(ex){}}}.bind(this)}catch(ex){}function Container(config){this.runQueue=[];this.tags={};this.config={cookieDomain:"",maxCookieLength:1000,gzip:true,delayDocWrite:false,clientId:"",name:"",tellLoadTimesProbability:0,pingServerUrl:null,trackSession:false,disabled:false,containerId:""};this.ignoreTagsState=false;if(config){this.setConfig(config);this.isTellingLoadTimes=this.config.tellLoadTimesProbability>Math.random();if(!config.name){this.config.name="Cont-"+_counter++}Container.register(this);this.ping=new qubit.opentag.Ping(this.config);var callback=this.sendPings.bind(this);this._pingAsyncCallback=function(){Timed.setTimeout(callback,5)
};if(this.config.trackSession){this.session=Session.setupSession(this.config)}if(this.session){}}return this}qubit.Define.clazz("qubit.opentag.Container",Container);var containers=[];Container.register=function(ref){Utils.addToArrayIfNotExist(containers,ref)};Container.findContainersByName=function(name){var items=this.getContainers();var results=[];for(var i=0;i<items.length;i++){if(items[i].config.name===name){results.push(items[i])}}return results};Container.getById=function(id){var items=this.getContainers();for(var i=0;i<items.length;i++){if(items[i].config.containerId===id){return items[i]}}return null};Container.prototype.unregister=function(){Container.unregister(this)};Container.unregister=function(ref){Utils.addToArrayIfNotExist(containers,ref);var index=Utils.removeFromArray(containers,ref);if(!index||index.length===0){}};Container.prototype.hasConsent=function(){return Cookie.get("qubitconsent")==="Accepted"};Container.prototype.register=function(ref){Container.register(ref||this)};Container.getContainers=function(){return containers};Container.prototype.getContainers=function(){return Container.getContainers()};Container.prototype.onTagRegistered=function(tag){};Container.prototype.registerTag=function(tag){var name=tag.config.name;if(this.tags[name]){}else{this.tags[name]=tag;try{this.onTagRegistered(tag)}catch(ex){}}};Container.prototype.registerTags=function(tags){for(var i=0;i<tags.length;i++){this.registerTag(tags[i])}};Container.prototype.setConfig=function(config){for(var prop in config){this.config[prop]=config[prop]}};Container.prototype.run=function(){this.runTags({command:"runOnceIfFiltersPass"})};Container.prototype.runWithoutFilters=function(){this.runTags({command:"run"})};Container.prototype.getTagByname=function(name){return this.tags[name]};Container.prototype.containerScriptLoadedSynchronously=function(){var i,ii,script,scripts,src;scripts=document.getElementsByTagName("script");for(i=0,ii=scripts.length;i<ii;i+=1){script=scripts[i];src=script.getAttribute("src");if(!!src&&(src.indexOf(""+this.config.clientId+"-"+this.config.containerId+".js")>0)){return(script.getAttribute("async")===null&&(script.getAttribute("defer")===false||script.getAttribute("defer")===""||script.getAttribute("defer")===null))}}return true};Container.prototype.runTags=function(config,force){if(!force){if(Container.LOCKED||Utils.global().QUBIT_CONTAINERS_LOCKED){return}}var forceAsync=!this.containerScriptLoadedSynchronously();var command="runIfFiltersPass";if(config&&config.command){command=config.command}this.runningStarted=new Date().valueOf();var firedTagsMap={};for(var name in this.tags){try{var tag=this.tags[name];if(this.includedToRun(tag)){var deps=tag.getDependencies();if(deps.length>0){for(var i=0;i<deps.length;i++){var dependency=deps[i];var depName=dependency.config.name;if(!firedTagsMap[depName]&&this.tags[depName]){firedTagsMap[depName]=dependency;this._tagRunner(dependency,command,forceAsync)}}}if(!firedTagsMap[name]){firedTagsMap[name]=tag;this._tagRunner(tag,command,forceAsync)}}}catch(ex){}}Timed.setTimeout(function(){this.sendPingsNotTooOften()}.bind(this),1100);this.waitForAllTagsToFinish()};Container.prototype._tagRunner=function(tag,command,forceAsync){try{if(this.includedToRun(tag)){if(forceAsync){tag.forceAsynchronous=true}if(this.config.delayDocWrite){tag.delayDocWrite=true}tag.session=tag.session||this.session;tag[command]()}}catch(ex){}};Container.prototype.includedToRun=function(tag){if(!tag){return false}var cfg=tag.config;if(cfg.inactive){return false}if(cfg.disabled){if(!tag.cookieSaysToRunEvenIfDisabled()){return false}}var consentOk=Container.consentIsGiven||(!cfg.needsConsent)||this.hasConsent();var atInitialState=(tag.state===BaseTag.prototype.STATE.INITIAL);return this.ignoreTagsState||(consentOk&&atInitialState)};Container.prototype.waitForAllTagsToFinish=function(){if(this._waitForAllTagsToFinishWaiting){return}if(!this._lastWaited){this._lastWaited=new Date().valueOf()}var timedOut=(new Date().valueOf()-this._lastWaited)>15*1000;var finished=this.allTagsFinished()||timedOut;if(!this._showFinishedOnce&&finished){this._lastWaited=null;if(timedOut){}this._showFinishedOnce=true;this.runningFinished=new Date().valueOf();this.sendPingsNotTooOften();if(this.onTagsInitiallyRun){this.onTagsInitiallyRun()}}else{if(!finished){this._waitForAllTagsToFinishWaiting=true;this._showFinishedOnce=false;Timed.setTimeout(function(){this._waitForAllTagsToFinishWaiting=false;this.waitForAllTagsToFinish()}.bind(this),100)}else{l.INFO("********************************************************");l.WARN("All tags seem to finished current jobs.");l.INFO("********************************************************")}}};Container.prototype.onTagsInitiallyRun=EMPTY_FUN;Container.prototype.resetAllTags=function(){for(var prop in this.tags){if(this.tags.hasOwnProperty(prop)){this.tags[prop].reset()}}};Container.prototype.reset=function(){this.runningFinished=undefined;this._waitForAllTagsToFinishWaiting=undefined;this.runningStarted=undefined;this._showFinishedOnce=undefined;this.resetAllTags()};Container.prototype.sendPingsNotTooOften=function(){this._sndLck=this._sndLck||{};Timed.runIfNotScheduled(this._pingAsyncCallback,2000,this._sndLck)};Container.prototype.sendPings=function(){var i;if(this.isTellingLoadTimes){var results=this.getAllTagsByState();var _this=this;var loadTimes;if(results.run){loadTimes=Tags.getLoadTimes(results.run);this.lastPingsSentTime=new Date().valueOf();this.ping.send(this.config,loadTimes)}loadTimes=Tags.getLoadTimes();var deduplicatedTagsToBeSent=[];for(i=0;i<loadTimes.length;i++){(function(j){var tag=loadTimes[j].tag;if(tag.config.dedupe&&tag.sendDedupePing){deduplicatedTagsToBeSent.push(tag)}}(i))}if(deduplicatedTagsToBeSent.length>0){this.lastDedupePingsSentTime=new Date().valueOf();this.ping.sendDedupe(this.config,deduplicatedTagsToBeSent)}if(results.other){loadTimes=Tags.getLoadTimes(results.other);var otherTagsToBeSent=[];for(i=0;i<loadTimes.length;i++){(function(j){var tag=loadTimes[j].tag;otherTagsToBeSent.push(loadTimes[j]);var after=tag.onAfter;tag.onAfter=function(success){after.call(tag,success);_this.sendPingsNotTooOften();if(success){}}}(i))}if(otherTagsToBeSent.length>0){this.ping.send(this.config,otherTagsToBeSent)}}if(results.awaiting){loadTimes=Tags.getLoadTimes(results.awaiting);var awaitingTagsToBeSent=[];for(i=0;i<loadTimes.length;i++){(function(j){var tag=loadTimes[j].tag;awaitingTagsToBeSent.push(loadTimes[j]);var after=tag.onAfter;tag.onAfter=function(success){after.call(tag,success);_this.sendPingsNotTooOften();if(success){}}}(i))}if(awaitingTagsToBeSent.length>0){this.ping.send(this.config,awaitingTagsToBeSent)}}}};Container.prototype.getAllTagsByState=function(){return Container.getAllTagsByState(this.tags)};Container.getAllTagsByState=function(tags){var runScripts=null,other=null,filterReady=null,failed=null,consent=null,locked=null;var LOWEST_FAIL_STATE=BaseTag.prototype.STATE.EXECUTED_WITH_ERRORS;for(var prop in tags){var tag=tags[prop];if(tag instanceof BaseTag){var name=tag.config.name;if(tag.scriptExecuted>0){runScripts=runScripts||{};attachRenamedIfExist(runScripts,tag,name)}else{if(tag.locked){locked=locked||{};attachRenamedIfExist(locked,tag,name)}else{if(tag.scriptExecuted<0||(tag.state>=LOWEST_FAIL_STATE)){failed=failed||{};attachRenamedIfExist(failed,tag,name)}else{if(tag.filtersState()===BaseFilter.state.SESSION||tag.filtersState()>0){filterReady=filterReady||{};attachRenamedIfExist(filterReady,tag,name)}else{if(tag.config.needsConsent){consent=consent||{};attachRenamedIfExist(consent,tag,name)}else{other=other||{};attachRenamedIfExist(other,tag,name)}}}}}}}return{run:runScripts,failed:failed,awaiting:filterReady,consent:consent,locked:locked,other:other}};var steps={};function attachRenamedIfExist(obj,src,name){if(obj[name]){steps[name]=steps[name]||1;name+="("+steps[name]+")";steps[name]++}obj[name]=src}Container.prototype.allTagsFinished=function(){for(var prop in this.tags){if(this.tags.hasOwnProperty(prop)){var tag=this.tags[prop];
if(tag instanceof qubit.opentag.BaseTag){var state=tag.filtersState();if(!tag.config.disabled){var notFailedAndUnlocked=tag.filtersState()<0&&!tag.locked;var tagNotFinishedOrNotRunner=!(tag.finished()||(tag.config.runner&&!tag.isRunning));if(notFailedAndUnlocked&&tagNotFinishedOrNotRunner){var isNotSession=(state!==BaseFilter.state.SESSION);var doesWaitForDeps=+tag.awaitingDependencies>0;if(isNotSession&&!doesWaitForDeps){return false}}}}}}return true};Container.prototype.getPageVariables=function(){var vars=[];for(var prop in this.tags){if(this.tags.hasOwnProperty(prop)){var tVars=this.tags[prop].getPageVariables();for(var i=0;i<tVars.length;i++){Utils.addToArrayIfNotExist(vars,tVars[i])}}}return vars};Container.getPageVariableByName=function(name){var vars=this.getAllPageVariables();var rets=[];for(var i=0;i<vars.length;i++){if(vars[i].config.name===name){rets.push(vars[i])}}return rets};Container.setCookieForDisabledContainersToRun=function(){qubit.Cookie.set("qubit.opentag.forceContainerRunning","true")};Container.rmCookieForDisabledContainersToRun=function(){qubit.Cookie.rm("qubit.opentag.forceContainerRunning")}})();(function(){var Utils=qubit.opentag.Utils;function LibraryTag(config){Utils.setIfUnset(config,LibraryTag.defaultConfig);if(this.singleton){var path=this.PACKAGE_NAME+"."+this.CLASS_NAME;var zuper=qubit.opentag.Utils.getObjectUsingPath(path,PKG_ROOT);if(zuper.__instance){return zuper.__instance}zuper.__instance=this}LibraryTag.superclass.call(this,config)}qubit.Define.clazz("qubit.opentag.LibraryTag",LibraryTag,qubit.opentag.BaseTag);LibraryTag.defaultConfig={vendor:null,imageUrl:null,description:"Provide description.",async:false,isPrivate:false,upgradeable:true,html:"",parameters:[]};LibraryTag.prototype.pre=function(){};LibraryTag.prototype.post=function(){};LibraryTag.prototype.before=function(){LibraryTag.superclass.prototype.before.call(this);if(this.config.html||this.config.script){return false}try{var cfg=this.config;if(cfg&&cfg.pre){if(typeof(cfg.pre)==="function"){this.pre=cfg.pre;this.pre()}else{var expr=this.replaceTokensWithValues(String(cfg.pre));if(this.config.prePostWindowScope){Utils.geval(expr)}else{this.pre=Utils.expressionToFunction(expr).bind(this);this.pre()}}}else{this.pre()}}catch(ex){return true}return false};LibraryTag.prototype.after=function(success){LibraryTag.superclass.prototype.after.call(this,success);if(this.config.html||this.config.script){return}try{var cfg=this.config;if(cfg&&cfg.post){if(typeof(cfg.post)==="function"){this.post=cfg.post;this.post(success)}else{var expr=this.replaceTokensWithValues(String(cfg.post));if(this.config.prePostWindowScope){Utils.geval(expr)}else{this.post=Utils.expressionToFunction(expr).bind(this);this.post(success)}}}else{this.post(success)}}catch(ex){}};LibraryTag.define=function(namespace,libConfig){namespace=namespace.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".");var libraryDefaultConfig=libConfig.config;var constr=libConfig.CONSTRUCTOR;var prototypeTemplate={};for(var prop in libConfig){if(prop!=="config"){prototypeTemplate[prop]=libConfig[prop]}}prototypeTemplate.CONSTRUCTOR=function(cfg){cfg=cfg||{};var defaultsCopy=Utils.objectCopy(libraryDefaultConfig,{maxDeep:8});for(var prop in defaultsCopy){if(!cfg.hasOwnProperty(prop)){cfg[prop]=defaultsCopy[prop]}}var ret=qubit.opentag.LibraryTag.call(this,cfg);if(constr){constr.call(this,cfg)}if(ret){return ret}};var ret=qubit.opentag.Utils.defineClass(namespace,LibraryTag,prototypeTemplate,GLOBAL);Utils.namespace("qubit.opentag.libraries."+namespace,ret);return ret}}());(function(){var Utils=qubit.opentag.Utils;function CustomTag(config){var defaults={url:null,html:"",locationPlaceHolder:"NOT_END",locationObject:"BODY",prePostWindowScope:true,async:true};Utils.setIfUnset(config,defaults);CustomTag.superclass.call(this,config)}qubit.Define.clazz("qubit.opentag.CustomTag",CustomTag,qubit.opentag.LibraryTag)}());(function(){var Define=qubit.Define;var PatternType={CONTAINS:"Contains",MATCHES_EXACTLY:"Matches Exactly",STARTS_WITH:"Starts with",ENDS_WITH:"Ends with",REGULAR_EXPRESSION:"Regular Expression",ALL_URLS:"All URLs"};Define.namespace("qubit.opentag.filter.pattern.PatternType",PatternType)}());(function(){var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var Timed=qubit.opentag.Timed;var PatternType=qubit.opentag.filter.pattern.PatternType;function URLFilter(config){this._lockObject={};var defaultConfig={patternType:PatternType.CONTAINS,pattern:""};if(config){for(var prop in config){if(config.hasOwnProperty(prop)){defaultConfig[prop]=config[prop]}}}URLFilter.superclass.call(this,defaultConfig)}qubit.Define.clazz("qubit.opentag.filter.URLFilter",URLFilter,BaseFilter);URLFilter.prototype.getURL=function(url){return url||Utils.getUrl()};URLFilter.prototype.match=function(url){url=this.getURL(url);var match=true;var pattern=this.config.pattern;switch(this.config.patternType){case PatternType.CONTAINS:match=(url.toLowerCase().indexOf(pattern.toLowerCase())>=0);break;case PatternType.MATCHES_EXACTLY:match=(url.toLowerCase()===this.config.pattern.toLowerCase());break;case PatternType.STARTS_WITH:match=(url.toLowerCase().indexOf(pattern.toLowerCase())===0);break;case PatternType.ENDS_WITH:match=((url.lastIndexOf(pattern.toLowerCase())+pattern.length)===url.length);break;case PatternType.REGULAR_EXPRESSION:match=new RegExp(pattern).test(url);break;case PatternType.ALL_URLS:match=true;break}return match}}());(function(){var Utils=qubit.opentag.Utils;var PatternType=qubit.opentag.filter.pattern.PatternType;var URLFilter=qubit.opentag.filter.URLFilter;var SessionVariableFilter=qubit.opentag.filter.SessionVariableFilter;var LibraryTag=qubit.opentag.LibraryTag;var CustomTag=qubit.opentag.CustomTag;var DOMText=qubit.opentag.pagevariable.DOMText;var BaseVariable=qubit.opentag.pagevariable.BaseVariable;var URLQuery=qubit.opentag.pagevariable.URLQuery;var Cookie=qubit.opentag.pagevariable.Cookie;var Expression=qubit.opentag.pagevariable.Expression;function OldTagRunner(config){this.config={filters:[],profileName:"",qTagClientId:"",pageVars:{},scriptLoaders:{},tellLoadTimesProbability:0,containerDisabled:false,pingServerUrl:"",qtag_domain:"",delayDocWrite:false,maxCookieLength:1000,containerName:""};this.config.qtag_track_session=true;for(var prop in config){if(config.hasOwnProperty(prop)){this.config[prop]=config[prop]}}}qubit.Define.clazz("qubit.opentag.OldTagRunner",OldTagRunner);OldTagRunner.prototype.run=function(){if(!this._run){this._run=new Date().valueOf();this.container=new qubit.opentag.Container({cookieDomain:this.config.qtag_domain,maxCookieLength:this.config.maxCookieLength,delayDocWrite:this.config.delayDocWrite,gzip:true,clientId:this.config.qTagClientId,containerId:this.config.profileName,name:this.config.containerName,tellLoadTimesProbability:this.config.tellLoadTimesProbability,disabled:this.config.containerDisabled,pingServerUrl:this.config.pingServerUrl,trackSession:this.config.qtag_track_session});var tags=this.getTags();this.container.registerTags(tags);if(!this.container.config.disabled){this.container.run()}else{var enabledByCookie=qubit.Cookie.get("qubit.opentag.forceContainerRunning");if(enabledByCookie!==null){this.container.run()}else{}}}};OldTagRunner.prototype.getTags=function(){var filters=this.config.filters;var tagDefinitions=this.config.scriptLoaders;var pageVars=this.config.pageVars;var tags=[];var prop,loader,tag;for(prop in tagDefinitions){if(tagDefinitions.hasOwnProperty(prop)){loader=tagDefinitions[prop];var filterDefinitions=findFilters(filters,prop);var parameterDefinitions=findParameters(loader,pageVars);var location="";if(loader.locationId===1){location="HEAD"}else{if(loader.locationId===2){location="BODY"}else{if(loader.locationId===3){location=loader.locationDetail}}}var dedupe=loader.dedupe;var cfg={name:loader.name,filters:filterDefinitions,parameters:parameterDefinitions,id:loader.id,locked:!!loader.locked,url:loader.url,html:loader.html,template:!!loader.template,locationPlaceHolder:((+loader.positionId)===1)?"NOT_END":"END",locationObject:location,disabled:loader.disabled,async:loader.async,needsConsent:loader.needsConsent,usesDocumentWrite:loader.usesDocWrite,genericDependencies:loader.genericDependencies};
if(loader.prePostWindowScope!==undefined){cfg.prePostWindowScope=loader.prePostWindowScope}if(loader.scriptTimeout){cfg.timeout=+loader.scriptTimeout}if(dedupe){cfg.dedupe=true}if(loader.runner){cfg.runner=loader.runner}if(loader.pre){cfg.pre=loader.pre}if(loader.post){cfg.post=loader.post}if(loader.script){cfg.script=loader.script}tag=null;if(cfg.template){tag=new LibraryTag(cfg)}else{tag=new CustomTag(cfg)}tagDefinitions[prop].instance=tag;tags.push(tag)}}for(prop in tagDefinitions){if(tagDefinitions.hasOwnProperty(prop)){var dependencies=[];loader=tagDefinitions[prop];if(loader.dependencies){for(var j=0;j<loader.dependencies.length;j++){var tagId=loader.dependencies[j];var dependency=tagDefinitions[tagId].instance;dependencies.push(dependency)}tag=loader.instance;tag.setDependencies(dependencies.concat(tag.getDependencies()))}}}return tags};var V_JS_VALUE="2";var V_QUERY_PARAM="3";var V_COOKIE_VALUE="4";var V_ELEMENT_VALUE="5";function findParameters(loader,variables){var parameters=loader.pageVars;var ret=[];for(var prop in parameters){if(parameters.hasOwnProperty(prop)){var param=parameters[prop];var variableDefinition=variables[prop];if(variableDefinition){var variable;var varCfg={name:variableDefinition.name,value:variableDefinition.value};switch(variableDefinition.type){case V_JS_VALUE:variable=new Expression(varCfg);break;case V_QUERY_PARAM:variable=new URLQuery(varCfg);break;case V_COOKIE_VALUE:variable=new Cookie(varCfg);break;case V_ELEMENT_VALUE:variable=new DOMText(varCfg);break;default:variable=new BaseVariable(varCfg)}var parameter={token:param.token};if(param.defaultValue){parameter.defaultValue=param.defaultValue}if(variable){parameter.variable=variable}ret.push(parameter)}}}return ret}var NORMAL_FILTER="1";var DEDUPE_URL_FILTER="2";var DEDUPE_SESSION_FILTER="3";var getFilterType=function(filter){var x=parseInt(filter.patternType,10);if((x<10)||(x===100)){return NORMAL_FILTER}if((x>=10)&&(x<20)){return DEDUPE_URL_FILTER}if(x===110){return DEDUPE_SESSION_FILTER}};function findFilters(filters,id){var filtersToReturn=[];for(var i=0;i<filters.length;i++){var filter=filters[i];var idx=Utils.indexInArray(filter.scriptLoaderKeys,id);if(idx!==-1){var session=false;switch(getFilterType(filter)){case NORMAL_FILTER:case DEDUPE_URL_FILTER:break;case DEDUPE_SESSION_FILTER:session=true;break}if(session||filter.starter||typeof(filter.pattern)==="function"){filter.instance=new SessionVariableFilter({include:(+filter.filterType===1),name:filter.name,customStarter:filter.starter,customScript:filter.pattern})}else{filter.instance=new URLFilter({include:(+filter.filterType===1),name:filter.name,patternType:resolvePatternType(filter),pattern:filter.pattern})}if(filter.priority!==undefined){filter.instance.config.order=+filter.priority}filtersToReturn.push(filter.instance)}}var sortFun=function(a,b){return +a.priority>+b.priority};return filtersToReturn.sort(sortFun)}var ALL="1";var SUBSTRING="2";var REGEX="3";var EXACT_MATCH="4";var FN="100";var DEDUPE_FN="110";function resolvePatternType(filter){switch(filter.patternType){case FN:case DEDUPE_FN:return null;case EXACT_MATCH:case"1"+EXACT_MATCH:return PatternType.MATCHES_EXACTLY;case SUBSTRING:case"1"+SUBSTRING:return PatternType.CONTAINS;case REGEX:case"1"+REGEX:return PatternType.REGULAR_EXPRESSION;case ALL:case"1"+ALL:return PatternType.ALL_URLS;default:return null}}})();(function(){function trim(text){return text.replace(/^\s+/,"").replace(/\s+$/,"")}var UVListener={callbacks:{},unfired_events:[],early_callbacks:null,currentUV:null},uv,uvLocation="universal_variable",starterId=0,POLL_DELAY_MS=500,timer;UVListener._isArray=function(input){return(Object.prototype.toString.call(input)==="[object Array]")};UVListener._targetChanged=function(keyString,old,newObject){var oldAsObject,oldTarget,newTarget;if(newObject===null){if(old==="null"){return false}else{return true}}else{if(newObject===undefined){if(old===newObject){return false}else{return true}}else{oldAsObject=JSON.parse(old);oldTarget=UVListener._getNested(oldAsObject,keyString);newTarget=UVListener._getNested(newObject,keyString);return !UVListener._jsonIsEqual(oldTarget,newTarget)}}};UVListener._processCallbacks=function(){var i;if(UVListener.early_callbacks&&UVListener.early_callbacks.length>0){for(i=0;i<UVListener.early_callbacks.length;i+=1){UVListener.push(UVListener.early_callbacks[i])}UVListener.early_callbacks=null}};UVListener._keyStringToArr=function(keyString){keyString=trim(keyString);if(keyString===""){return[]}else{keyString=keyString.replace(/\[(\w+)\]/g,".$1");keyString=keyString.replace(/^\./,"");return keyString.split(".")}};UVListener._getNested=function(object,keyString){var arr=UVListener._keyStringToArr(keyString),n;while(arr.length>0){n=arr.shift();if(object.hasOwnProperty(n)){object=object[n]}else{return}}return object};UVListener._jsonIsEqual=function(obj1,obj2){if(typeof obj1!=="string"){obj1=JSON.stringify(obj1,UVListener._stripEvents)}if(typeof obj2!=="string"){obj2=JSON.stringify(obj2,UVListener._stripEvents)}return obj1===obj2};UVListener._stripEvents=function(key,value){if(key!=="events"){return value}else{return undefined}};UVListener._on=function(type,func){var typeArray,key;typeArray=type.split(":");type=typeArray[0];key=typeArray[1];UVListener.callbacks[type]=UVListener.callbacks[type]||[];if(key){UVListener.callbacks[type].push({keyString:key,func:func})}else{UVListener.callbacks[type].push({func:func})}};UVListener._trigger=function(type,data){var i,keyString;if(UVListener.callbacks[type]){for(i=0;i<UVListener.callbacks[type].length;i+=1){if(typeof UVListener.callbacks[type][i].func==="function"){keyString=UVListener.callbacks[type][i].keyString;if(keyString){if(type==="change"&&UVListener._targetChanged(keyString,UVListener.currentUV,uv)){UVListener.callbacks[type][i].func(data)}}else{UVListener.callbacks[type][i].func(data)}}}}};UVListener._eventsPush=function(evt){var i,ii;uv.events[uv.events.length]=evt;evt.time=evt.time||(new Date()).getTime();if(UVListener.callbacks.event){i=0;ii=UVListener.callbacks.event.length;for(i;i<ii;i+=1){UVListener.callbacks.event[i].func(evt)}}evt.has_fired=true};UVListener._getUnfiredEvents=function(){var i=0;for(i=0;i<uv.events.length;i+=1){if(!uv.events[i].has_fired){UVListener.unfired_events.push(uv.events.splice(i,1)[0]);i-=1}}};UVListener._fireEvents=function(){while(UVListener.unfired_events.length>0){uv.events.push(UVListener.unfired_events.shift())}};UVListener._resetEventsPush=function(){uv.events=uv.events||[];if(uv.events.push.toString().indexOf("[native code]")!==-1){uv.events.push=UVListener._eventsPush;UVListener._getUnfiredEvents();UVListener._fireEvents()}};UVListener._checkForChanges=function(){if(UVListener.callbacks.change&&UVListener.callbacks.change.length>0){if(!UVListener._jsonIsEqual(UVListener.currentUV,uv)){UVListener._trigger("change",uv);UVListener.currentUV=JSON.stringify(uv,UVListener._stripEvents)}}};UVListener._setUVLocation=function(newLoc){uvLocation=newLoc;UVListener._initUV()};UVListener._initUV=function(){window[uvLocation]=window[uvLocation]||{events:[]};uv=window[uvLocation];if(!uv.events){uv.events=[]}};UVListener.push=function(data){if(!UVListener._isArray(data)){return}if(data[0]==="on"){UVListener._on(data[1],data[2])}else{if(data[0]==="trigger"&&data[1]){UVListener._trigger(data[1])}}};UVListener.init=function(testing,uvLoc){if(uvLoc){uvLocation=uvLoc}UVListener._initUV();if(!window.uv_listener||UVListener._isArray(window.uv_listener)){UVListener.early_callbacks=window.uv_listener||null;window.uv_listener=UVListener;if(!testing){UVListener.start()}}else{if(uvLoc){window.uv_listener._setUVLocation(uvLocation)}}};UVListener.start=function(){UVListener.currentUV=JSON.stringify(uv,UVListener._stripEvents);timer=setInterval(function(){UVListener._initUV();UVListener._resetEventsPush();UVListener._checkForChanges()},POLL_DELAY_MS);UVListener._processCallbacks()};q.html.UVListener=UVListener}());(function(){var filters=[],pageVars={},scriptLoaders={},delayDocWrite=false,qTagClientId="",containerName="Opentag",profileName="",tellLoadTimesProbability=0,containerDisabled=false,maxCookieLength=1000,pingServerUrl=null,qtag_track_session=false,qtag_domain="",scriptURL=null;
var qTagClientId="112905";var profileName="1521957";var filters=[{filterType:"1",name:"Yellow Platinum Tiles Filter",patternType:"100",pattern:function(session){return(Qubit.pageType==="ssrp"&&Qubit.searchIntent==="typeSearch"&&matchMedia("all and (min-width: 1024px)").matches)},starter:function(session,cb){cb()},priority:1,id:70305271,scriptLoaderKeys:["33543770"]},{filterType:"1",name:"Platinum Tiles Stylesheet Filter",patternType:"100",pattern:function(session){return(Qubit.pageType==="ssrp"&&Qubit.searchIntent==="typeSearch"&&window.matchMedia("all and (min-width: 1024px)").matches)},starter:function(session,cb){cb()},priority:1,id:70305312,scriptLoaderKeys:["42534125"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305321,scriptLoaderKeys:["42534135"]},{filterType:"1",name:"Yellow SSN Stylesheet filter",patternType:"100",pattern:function(session){return(Qubit.pageType==="bpp"&&Qubit.isFreeListing)},starter:function(session,cb){cb()},priority:1,id:70305335,scriptLoaderKeys:["42534143"]},{filterType:"1",name:"MREC Stylesheet Filter",patternType:"100",pattern:function(session){return(Qubit.pageType==="bpp"&&Qubit.isFreeListing)},starter:function(session,cb){cb()},priority:1,id:70305344,scriptLoaderKeys:["42534149"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305345,scriptLoaderKeys:["42534156"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305348,scriptLoaderKeys:["42534157"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305359,scriptLoaderKeys:["42534165"]},{filterType:"1",name:"Yellow PlatinumBanner Stylesheet filter",patternType:"100",pattern:function(session){return(Qubit.pageType==="ssrp"&&Qubit.searchIntent==="typeSearch"&&matchMedia("all and (min-width: 768px)").matches)},starter:function(session,cb){cb()},priority:1,id:70305365,scriptLoaderKeys:["42534180"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305372,scriptLoaderKeys:["43389013"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305387,scriptLoaderKeys:["43701619"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:70305390,scriptLoaderKeys:["47531974"]}];var containerDisabled=false;var pageVars={"-2621157":{name:"Qubit.locationClue",value:"Qubit.locationClue",type:"2"},"-2621159":{name:"Qubit.state",value:"Qubit.state",type:"2"},"-2621160":{name:"Qubit.headingName",value:"Qubit.headingName",type:"2"},"-2621156":{name:"Qubit.adPos2DivId",value:"Qubit.adPos2DivId",type:"2"},"-2621161":{name:"Qubit.searchTerm",value:"Qubit.searchTerm",type:"2"},"-2621158":{name:"Qubit.postcodes",value:"Qubit.postcodes",type:"2"},"-2621162":{name:"Qubit.postcodes",value:"Qubit.postcodes",type:"2"},"-2621165":{name:"Qubit.adPos1DivId",value:"Qubit.adPos1DivId",type:"2"},"-2621163":{name:"Qubit.state",value:"Qubit.state",type:"2"},"-2621166":{name:"Qubit.headingName",value:"Qubit.headingName",type:"2"},"-2621164":{name:"Qubit.headingId",value:"Qubit.heading",type:"2"},"-2621168":{name:"Qubit.headingId",value:"Qubit.heading",type:"2"},"-2621170":{name:"Qubit.adPos1DivId",value:"Qubit.adPos1DivId",type:"2"},"-2621167":{name:"Qubit.isFreeListing",value:"Qubit.isFreeListing",type:"2"},"-2621171":{name:"Qubit.pageType",value:"Qubit.pageType",type:"2"},"-2621169":{name:"Qubit.headingName",value:"Qubit.headingName",type:"2"},"-2621173":{name:"Qubit.pageType",value:"Qubit.pageType",type:"2"},"-2621172":{name:"Qubit.headingId",value:"Qubit.heading",type:"2"},"-2621175":{name:"Qubit.state",value:"Qubit.state",type:"2"},"-2621174":{name:"Qubit.isFreeListing",value:"Qubit.isFreeListing",type:"1"},"-2621176":{name:"Qubit.adPos2DivId",value:"Qubit.adPos2DivId",type:"2"},"-2621179":{name:"category html friendly",value:'Qubit.headingName.replace(/[^A-Z0-9]+/ig, "-")',type:"2"},"-2621181":{name:"categoryId",value:"Qubit.heading",type:"2"},"-2621178":{name:"state",value:"Qubit.state",type:"2"},"-2621184":{name:"networkId",value:"Config.networkId",type:"2"},"-2621182":{name:"listtype",value:"Qubit.isFreeListing ? 'free' : 'paid'",type:"2"},"-2621177":{name:"section",value:"Qubit.pageType",type:"2"},"-2621180":{name:"busname html friendly",value:'Qubit.businessName.replace(/[^A-Z0-9]+/ig, " ")',type:"2"},"-2621185":{name:"targeting",value:"Config.targeting",type:"2"},"-2621186":{name:"krux.user",value:"Krux.sensis.user",type:"2"},"-2621183":{name:"pcode",value:"Qubit.postcode",type:"2"},"-2621197":{name:"krux.user",value:"Krux.sensis.user",type:"2"},"-2621187":{name:"section",value:"Qubit.pageType",type:"2"},"-2621192":{name:"listtype",value:"Qubit.isFreeListing ? 'free' : 'paid'",type:"2"},"-2621193":{name:"pcode",value:"Qubit.postcode",type:"2"},"-2621195":{name:"networkId",value:"Config.networkId",type:"2"},"-2621189":{name:"category html friendly",value:'Qubit.headingName.replace(/[^A-Z0-9]+/ig, "-")',type:"2"},"-2621190":{name:"busname html friendly",value:'Qubit.businessName.replace(/[^A-Z0-9]+/ig, " ")',type:"2"},"-2621188":{name:"state",value:"Qubit.state",type:"2"},"-2621191":{name:"categoryId",value:"Qubit.heading",type:"2"},"-2621194":{name:"ssn element",value:"Qubit.adPos1DivId",type:"2"},"-2621196":{name:"targeting",value:"Config.targeting",type:"2"},"-2621204":{name:"category html friendly",value:'Qubit.headingName.replace(/[^A-Z0-9]+/ig, "-")',type:"2"},"-2621208":{name:"krux.user",value:"Krux.sensis.user",type:"2"},"-2621205":{name:"Search Term",value:"Qubit.searchTerm",type:"2"},"-2621202":{name:"adPos2DivId",value:"Qubit.adPos2DivId",type:"2"},"-2621203":{name:"state",value:"Qubit.state",type:"2"},"-2621206":{name:"targeting",value:"Config.targeting",type:"2"},"-2621198":{name:"section",value:"Qubit.pageType",type:"2"},"-2621199":{name:"region html friendly",value:'Qubit.regions.toString().replace(/[^A-Z0-9\\,]+/ig, " ")',type:"2"},"-2621200":{name:"pcode string",value:"Qubit.postcodes.toString()",type:"2"},"-2621207":{name:"networkId",value:"Config.networkId",type:"2"},"-2621201":{name:"categoryId",value:"Qubit.heading",type:"2"}};var scriptLoaders={33543770:{id:"33543770",name:"Yellow Platinum Tiles",scriptTimeout:5000,disabled:true,dedupe:false,pre:"",url:"",post:"",html:"// STAGING\x0A\x0A<script>\x0A  var zMSHome = \x22//pubads.g.doubleclick.net/gampad/\x22;\x0A  var siteId = \x22ZYELLOWPAGES.PLATINUM\x22;\x0A  var DFP_NETWORKID = \x227434\x22;\x0A  var RAND_MAX = 10000000;\x0A  var NUM_PLATINUM_TILES = 3;\x0A  var cValue = zMSRand();\x0A\x0A  var searchLocation = \x22${Qubit.state}\x22;\x0A  // postcodes must be an array. If array assignment fails, set it to a blank array.\x0A  try {\x0A      var postcodes = ${Qubit.postcodes};\x0A  } catch(e) {\x0A      var postcodes = [];\x0A  }  \x0A  var headingId = \x22${Qubit.headingId}\x22; \x0A  var sixCharHeadingId = strPad(headingId, 6);\x0A  \x0A  var heading = \x22${Qubit.headingName}\x22;\x0A  var containingDiv = \x22${Qubit.adPos1DivId}\x22;\x0A  var platinumAdsContainingDivId = \x22platinum-ads\x22;\x0A    \x0A  var outerDiv = document.createElement(\x22div\x22);\x0A  outerDiv.className = \x22platinum-ads clearfix\x22;  \x0A  var platinumAdsDiv = document.createElement(\x22div\x22);  \x0A  platinumAdsDiv.className = \x22platinum-tiles clearfix\x22;  \x0A  platinumAdsDiv.id = \x22platinum-ads\x22;\x0A  var platinumDecorationsDiv = document.createElement(\x22div\x22);\x0A  platinumDecorationsDiv.className = \x22platinum-decorations\x22;\x0A  jQuery(platinumDecorationsDiv).append(\x27<p>Ads for <span class=\x22heading-name\x22>\x27+heading+\x27</span></p>\x27);\x0A  var calloutAnchorDiv = document.createElement(\x22div\x22);\x0A  calloutAnchorDiv.className = \x22platinum-callout-anchor\x22;  \x0A  jQuery(calloutAnchorDiv).append(\x27<img src=\x22data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB94MDAImDdUtrrEAAAFrSURBVCjPbZIhiBthEIW/tw1UVMWsyIlCXVp1cCockVVVqUhUFwo1V7frzp7OrxpxrlvVmIg7KHWVoVCoKcSVqhMRNYW666vY+cNy3MAPPzNvHm/ejOhFXdcjSRUwB8a2kbQD1rbblNJNxgqgaZoCmAEroIwGAGx3QGkPvLW9SSn9K4JgBnwEygD1GzJJGZgZgJqmGQHfc5Ptv5KugR/AI+A0nkPhHjgugMp2GQUkvbP9BrgCVrYr2x+iyYGtCtvzPE/EN0knwCfbX1JKPyV9PpjSjTEfSMruKaReSnpo+0bS+8g9j7ICOx70HQQsaRjME+BJXde/I+cu3WGL2BO94XMcAa+AYa/mULArYrncExe2n2aJB0mdwnUBtLHcA2MAziWd9Yiy1D3QPthut38mk8kv4CVQ9ADPbL+Q9Lgn9db265TS13w5G9sLYG87uzsFpvHPi18AG+6YQVxRFbsdR3oHrIF2uVwejvw/tQey5K2VG70AAAAASUVORK5CYII=\x22  onclick=\x22discription()\x22 class=\x22question-mark\x22 alt=\x22question mark\x22> </img>\x27);\x0A  var platinumCalloutDiv = document.createElement(\x22div\x22);\x0A  platinumCalloutDiv.className = \x22platinum-callout\x22;\x0A  var platinumCalloutBodyDiv = document.createElement(\x22div\x22);\x0A  platinumCalloutBodyDiv.className = \x22platinum-callout-body\x22;\x0A  jQuery(platinumCalloutBodyDiv).append(\x22These are ads purchased by advertisers for a category that could be relevant to your search.\x22);\x0A  var arrowBorderDiv = document.createElement(\x22div\x22);\x0A  arrowBorderDiv.className = \x22platinum-callout-arrow-border\x22;\x0A  var arrowDiv = document.createElement(\x22div\x22);\x0A  arrowDiv.className = \x22platinum-callout-arrow\x22;\x0A  \x0A  jQuery(platinumCalloutDiv).append(platinumCalloutBodyDiv);\x0A  jQuery(platinumCalloutDiv).append(arrowBorderDiv);\x0A  jQuery(platinumCalloutDiv).append(arrowDiv);\x0A  jQuery(platinumDecorationsDiv).append(calloutAnchorDiv);\x0A  jQuery(platinumDecorationsDiv).append(platinumCalloutDiv);  \x0A  jQuery(outerDiv).append(platinumAdsDiv);\x0A  jQuery(outerDiv).append(platinumDecorationsDiv);\x0A  \x0A  jQuery(\x22#\x22 + containingDiv).append(outerDiv);  \x0A  \x0A  /**\x0A  * Adds zero to the beginning of the string to make it get to the determined length\x0A  **/\x0A  function strPad(input,len) {\x0A      var o = input.toString();\x0A      while (o.length < len) {\x0A          o = \x270\x27 + o;\x0A      }\x0A      return o;\x0A  };\x0A  \x0A  function discription() {\x0A    if ($(\x22.platinum-callout.displayed\x22).length != 0) {\x0A      $(\x22.platinum-callout\x22).removeClass(\x22displayed\x22);\x0A    } else {\x0A      $(\x22.platinum-callout\x22).addClass(\x22displayed\x22);\x0A    }\x0A  }  \x0A  \x0A\x0A/**\x0A * Generates a random integer between 0 and RAND_MAX.\x0A**/\x0Afunction zMSRand() {\x0A    return Math.round(Math.random() * RAND_MAX);\x0A}\x0A\x0Afor (i = 0; i < NUM_PLATINUM_TILES; i++) {\x0A    platinumAd(siteId, searchLocation, sixCharHeadingId, postcodes, i + 1);\x0A}\x0A  \x0A/**\x0A * Generate an ad call URL of the old non havascript form.\x0A**/\x0Afunction buildAdUrl(site, params, prefix, tile) {\x0A    var url = zMSHome + prefix + \x22?iu=\x22+DFP_NETWORKID+\x22/\x22+site;\x0A    url += \x22&t=\x22;\x0A    var i = 0;\x0A    for (var key in params) {\x0A        if (params.hasOwnProperty(key)) {\x0A            var value = params[key];\x0A            if(key != \x22sz\x22){\x0A                if(i > 0)\x0A                    url += escape(\x22&\x22);\x0A                url += escape(key + \x22=\x22 + value);\x0A                i++;\x0A            }\x0A        }\x0A    }\x0A    url += \x22&sz=\x22+params[\x27sz\x27]+ \x22&tile=\x22 + tile + \x22&c=\x22 + cValue;\x0A\x0A    return url;\x0A}\x0A  \x0A$().ready(function() {\x0A    // hide the containing div initially in case no ads are returned\x0A    $(\x22.platinum-ads\x22).attr(\x22style\x22, \x22display: none !important\x22);      \x0A});\x0A  \x0A$(window).load(function() {\x0A    log(\x22Attempting to remove invalid images...\x22);\x0A    removeImages();\x0A  \x0A    // if there are tiles show the containing div\x0A    if ($(\x27.platinum-tiles a\x27).length > 0) {               \x0A        $(\x22.platinum-ads\x22).attr(\x22style\x22, \x22display: block !important\x22);\x0A    }\x0A});\x0A\x0Afunction removeZeroPadding(s) {\x0A    var i = 0;\x0A    while (i < s.length && s.charAt(i) == \x270\x27) i++;\x0A    return s.substr(i);\x0A}\x0A\x0Afunction removeImages() {\x0A    \x22use strict\x22;\x0A    var k, i, numImages, images, imageToRemove, width = 0;\x0A    images = $(\x27.platinum-tiles img\x27);\x0A    log(images.length + \x22 platinum images found\x22);\x0A\x0A    for (k = 0; k < images.length; k++) {\x0A        removeUndersizedImage(images[k]);\x0A    }\x0A}\x0A\x0Afunction browserIsIE() {\x0A    return (navigator.userAgent.indexOf(\x22MSIE\x22) != -1);\x0A}\x0A\x0A/**\x0A * DFP returns a 1x1 image if no ad is found. These images need to be removed\x0A * from the dom to avoid display issues on the page.\x0A**/\x0Afunction removeUndersizedImage(originalImage) {\x0A    \x22use strict\x22;\x0A    var src, img, imageToRemove, width = 0;\x0A\x0A    src = originalImage.getAttribute(\x27src\x27);\x0A    img = document.createElement(\x27img\x27);\x0A    img.src = src;\x0A\x0A    if (img.complete && (!img.width || !img.src)) {\x0A        return;\x0A    } else {\x0A        width = img.width;\x0A\x0A        if (width == 1) {\x0A            imageToRemove = $(originalImage).parent();\x0A            log(\x27Marking image for removal - unexpected image width: \x27 + width + \x27px\x27);\x0A            log(\x22Removing image\x22);\x0A            $(imageToRemove).remove();\x0A\x0A            if ($(imageToRemove).is(\x22html *\x22)) {\x0A                log(\x22   image could not be removed\x22);\x0A            } else {\x0A                log(\x22   image successfully removed\x22);\x0A            }\x0A        }\x0A    }\x0A\x0A    return;\x0A}\x0A\x0Afunction getWidthWhenImageLoaded(img, originalImage, callback) {\x0A    \x22use strict\x22;\x0A    img.onload = function () {\x0A        callback(img.width, originalImage);\x0A    };\x0A\x0A    return img.width;\x0A}\x0A\x0Afunction log(t){\x0A    if (typeof(console) != \x27undefined\x27){\x0A        console.log(t);\x0A    }\x0A}\x0A\x0A/**\x0A * Generate a Platinum ad call.\x0A**/\x0Afunction platinumAd(siteId, searchLocation, headingId, postcodes, tile) {\x0A    // YPOL sends us heading codes with a leading zero, but the reference data\x0A    // omits it: strip out leading zeroes sent by YPOL.   \x0A    var yplathead = removeZeroPadding(headingId.toString());\x0A    var params = [];\x0A\x0A    if (!postcodes) postcodes = [];\x0A    if (searchLocation === \x22\x22) {\x0A      searchLocation = \x22NAT\x22;\x0A    }\x0A        \x0A    // zero pad postcodes under 4 characters \x0A    for (var i=0; i < postcodes.length; i++) {\x0A        postcodes[i] = strPad(postcodes[i], 4);\x0A        log(\x22Postcode padded: \x22 + postcodes[i]);\x0A    }\x0A  \x0A    if (postcodes.length == 0) {\x0A        // book, state or national search\x0A        postcode_param = \x22.\x22;      \x0A    }\x0A    else if (postcodes.length == 1) {\x0A        // postcode search\x0A        postcode_param = postcodes[0];\x0A    } else if (postcodes.length > 1) {\x0A        // regional search (eg. Greater Western Sydney)\x0A        postcode_param = postcodes.join(\x22 \x22);\x0A    }\x0A  \x0A    params[\x22SITE\x22] = siteId;\x0A    params[\x22STATE\x22] = searchLocation;\x0A    params[\x22POSTCODE\x22] = postcode_param;    \x0A    params[\x22sz\x22] = \x22138x95\x22;\x0A    params[\x22YPLATHEAD\x22] = yplathead;\x0A\x0A    var url = buildAdUrl(siteId, params, \x22jump\x22, tile);        \x0A    var a = document.createElement(\x22a\x22);\x0A    a.href = url;\x0A    $(a).click(function() { window.open(this.href, \x27_blank\x27); return false; });\x0A      \x0A    var url = buildAdUrl(siteId, params, \x22ad\x22, tile);    \x0A  \x0A    var img = document.createElement(\x22img\x22);\x0A    img.id = \x22platinumImage\x22 + tile;\x0A    img.src = url;\x0A    $(a).append(img);    \x0A    \x0A    $(\x22#\x22 + platinumAdsContainingDivId).append(a);\x0A}               \x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{"-2621162":{token:"Qubit.postcodes",defaultValue:""},"-2621163":{token:"Qubit.state",defaultValue:""},"-2621164":{token:"Qubit.headingId",defaultValue:""},"-2621165":{token:"Qubit.adPos1DivId",defaultValue:""},"-2621166":{token:"Qubit.headingName",defaultValue:""}},dependencies:[42534125,42534135]},42534125:{id:"42534125",name:"Yellow Platinum Tiles - Stylesheet",scriptTimeout:5000,disabled:true,dedupe:false,pre:"",url:"",post:"",html:"<script> \x0A var css =\x22      .platinum-tiles img {\x22 +\x0A\x22            margin-right: 15px;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-decorations p {\x22 +\x0A\x22            margin: 0px;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-decorations {\x22 +\x0A\x22            color: #737373;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-callout-anchor img {\x22 +\x0A\x22            width: 14px;\x22 +\x0A\x22            color: #737373;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads {\x22 +\x0A\x22            min-height: 30px;\x22 +\x0A\x22            font-family: Helvetica, sans-serif;\x22 +\x0A\x22            background-color: #F7F7F7;\x22 +\x0A\x22            border-style: solid;\x22 +\x0A\x22            border-color: #DDDDDD;\x22 +\x0A\x22            border-width: 1px;\x22 +\x0A\x22            -webkit-border-radius: 8px;\x22 +\x0A\x22            -moz-border-radius: 8px;\x22 +\x0A\x22            border-radius: 8px;\x22 +\x0A\x22            position: relative;\x22 +\x0A\x22            padding: 10px 15px;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-tiles {\x22 +\x0A\x22            float: left;\x22 +\x0A\x22        }\x22 +\x0A\x22        .clearfix {\x22 +\x0A\x22            display: block;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-decorations {\x22 +\x0A\x22            font-size: 12px;\x22 +\x0A\x22            color: #737373;\x22 +\x0A\x22            text-align: right;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-decorations .platinum-callout-anchor {\x22 +\x0A\x22            font-size: 14px;\x22 +\x0A\x22            position: absolute;\x22 +\x0A\x22            bottom: 0;\x22 +\x0A\x22            right: 5px;\x22 +\x0A\x22            width: 36px;\x22 +\x0A\x22            text-align: center;\x22 +\x0A\x22            cursor: pointer;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-callout-anchor img {\x22 +\x0A\x22            padding-bottom: 10px;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-decorations .platinum-callout {\x22 +\x0A\x22            display: none;\x22 +\x0A\x22            position: absolute;\x22 +\x0A\x22            bottom: -7px;\x22 +\x0A\x22            right: 40px;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-decorations .platinum-callout .platinum-callout-body {\x22 +\x0A\x22            -moz-box-shadow: 0 0 4px 1px rgba(0, 0, 0, 0.15);\x22 +\x0A\x22            -webkit-box-shadow: 0 0 4px 1px rgba(0, 0, 0, 0.15);\x22 +\x0A\x22            box-shadow: 0 0 4px 1px rgba(0, 0, 0, 0.15);\x22 +\x0A\x22            -webkit-border-radius: 8px;\x22 +\x0A\x22            -moz-border-radius: 8px;\x22 +\x0A\x22            border-radius: 8px;\x22 +\x0A\x22            background-color: #fce5a2;\x22 +\x0A\x22            border: 1px solid #ffcc00;\x22 +\x0A\x22            padding: 10px;\x22 +\x0A\x22            text-align: left;\x22 +\x0A\x22            width: 235px;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-decorations .platinum-callout .platinum-callout-arrow-border {\x22 +\x0A\x22            position: absolute;\x22 +\x0A\x22            top: 20px;\x22 +\x0A\x22            right: -6px;\x22 +\x0A\x22            width: 0px;\x22 +\x0A\x22            height: 0px;\x22 +\x0A\x22            border-top: 6px solid;\x22 +\x0A\x22            border-bottom: 6px solid;\x22 +\x0A\x22            border-color: rgba(255, 255, 255, 0);\x22 +\x0A\x22            border-color: transparent\x5C9;\x22 +\x0A\x22            border-left: 6px solid #ffcc00;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads .platinum-decorations .platinum-callout .platinum-callout-arrow {\x22 +\x0A\x22            position: absolute;\x22 +\x0A\x22            top: 21px;\x22 +\x0A\x22            right: -4px;\x22 +\x0A\x22            width: 0px;\x22 +\x0A\x22            height: 0px;\x22 +\x0A\x22            border-top: 5px solid;\x22 +\x0A\x22            border-bottom: 5px solid;\x22 +\x0A\x22            border-color: rgba(255, 255, 255, 0);\x22 +\x0A\x22            border-color: transparent\x5C9;\x22 +\x0A\x22            border-left: 5px solid #fce5a2;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-callout.displayed {\x22 +\x0A\x22            display: block !important;\x22 +\x0A\x22        }\x22 +\x0A\x22        .platinum-ads {\x22 +\x0A\x22            display: block;\x22 +\x0A\x22        }    \x22 +\x0A\x22    .platinum-tile-cell { \x22 +\x0A\x22        display: block; \x22 +\x0A\x22    } \x22 +\x0A\x22    .clearfix:after {\x22 +\x0A\x22        visibility: hidden;\x22 +\x0A\x22        display: block;\x22 +\x0A\x22        font-size: 0;\x22 +\x0A\x22        content: \x5C\x22 \x5C\x22;\x22 +\x0A\x22        clear: both;\x22 +\x0A\x22        height: 0;\x22 +\x0A\x22    }\x22;\x0A\x0Avar head = document.head || document.getElementsByTagName(\x27head\x27)[0];\x0Avar style = document.createElement(\x27style\x27);\x0A\x0Astyle.type = \x27text/css\x27;\x0Aif (style.styleSheet){\x0A  style.styleSheet.cssText = css;\x0A} else {\x0A  style.appendChild(document.createTextNode(css));\x0A}\x0A\x0Ahead.appendChild(style);\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},42534135:{id:"42534135",name:"Yellow Platinum Tiles - Match Media Polyfill",scriptTimeout:5000,disabled:true,dedupe:false,pre:"",url:"",post:"",html:"<script>\x0Awindow.matchMedia || (window.matchMedia = function(e) {\x0A    \x22use strict\x22;\x0A    var t = e.document,\x0A        n = t.documentElement,\x0A        r = [],\x0A        i = 0,\x0A        s = \x22\x22,\x0A        o = {},\x0A        u = /\x5Cs*(only|not)?\x5Cs*(screen|print|[a-z\x5C-]+)\x5Cs*(and)?\x5Cs*/i,\x0A        a = /^\x5Cs*\x5C(\x5Cs*(-[a-z]+-)?(min-|max-)?([a-z\x5C-]+)\x5Cs*(:?\x5Cs*([0-9]+(\x5C.[0-9]+)?|portrait|landscape)(px|em|dppx|dpcm|rem|%|in|cm|mm|ex|pt|pc|\x5C/([0-9]+(\x5C.[0-9]+)?))?)?\x5Cs*\x5C)\x5Cs*$/,\x0A        f = 0,\x0A        l = function(e) {\x0A            var t = e.indexOf(\x22,\x22) !== -1 && e.split(\x22,\x22) || [e],\x0A                n = t.length - 1,\x0A                r = n,\x0A                i = null,\x0A                f = null,\x0A                l = \x22\x22,\x0A                c = 0,\x0A                h = false,\x0A                p = \x22\x22,\x0A                d = \x22\x22,\x0A                v = null,\x0A                m = 0,\x0A                g = 0,\x0A                y = null,\x0A                b = \x22\x22,\x0A                w = \x22\x22,\x0A                E = \x22\x22,\x0A                S = \x22\x22,\x0A                x = \x22\x22,\x0A                T = false;\x0A            if (e === \x22\x22) {\x0A                return true\x0A            }\x0A            do {\x0A                i = t[r - n];\x0A                h = false;\x0A                f = i.match(u);\x0A                if (f) {\x0A                    l = f[0];\x0A                    c = f.index\x0A                }\x0A                if (!f || i.substring(0, c).indexOf(\x22(\x22) === -1 && (c || !f[3] && l !== f.input)) {\x0A                    T = false;\x0A                    continue\x0A                }\x0A                d = i;\x0A                h = f[1] === \x22not\x22;\x0A                if (!c) {\x0A                    p = f[2];\x0A                    d = i.substring(l.length)\x0A                }\x0A                T = p === s || p === \x22all\x22 || p === \x22\x22;\x0A                v = d.indexOf(\x22 and \x22) !== -1 && d.split(\x22 and \x22) || [d];\x0A                m = v.length - 1;\x0A                g = m;\x0A                if (T && m >= 0 && d !== \x22\x22) {\x0A                    do {\x0A                        y = v[m].match(a);\x0A                        if (!y || !o[y[3]]) {\x0A                            T = false;\x0A                            break\x0A                        }\x0A                        b = y[2];\x0A                        w = y[5];\x0A                        S = w;\x0A                        E = y[7];\x0A                        x = o[y[3]];\x0A                        if (E) {\x0A                            if (E === \x22px\x22) {\x0A                                S = Number(w)\x0A                            } else if (E === \x22em\x22 || E === \x22rem\x22) {\x0A                                S = 16 * w\x0A                            } else if (y[8]) {\x0A                                S = (w / y[8]).toFixed(2)\x0A                            } else if (E === \x22dppx\x22) {\x0A                                S = w * 96\x0A                            } else if (E === \x22dpcm\x22) {\x0A                                S = w * .3937\x0A                            } else {\x0A                                S = Number(w)\x0A                            }\x0A                        }\x0A                        if (b === \x22min-\x22 && S) {\x0A                            T = x >= S\x0A                        } else if (b === \x22max-\x22 && S) {\x0A                            T = x <= S\x0A                        } else if (S) {\x0A                            T = x === S\x0A                        } else {\x0A                            T = !!x\x0A                        }\x0A                        if (!T) {\x0A                            break\x0A                        }\x0A                    } while (m--)\x0A                }\x0A                if (T) {\x0A                    break\x0A                }\x0A            } while (n--);\x0A            return h ? !T : T\x0A        },\x0A        c = function() {\x0A            var t = e.innerWidth || n.clientWidth,\x0A                r = e.innerHeight || n.clientHeight,\x0A                i = e.screen.width,\x0A                s = e.screen.height,\x0A                u = e.screen.colorDepth,\x0A                a = e.devicePixelRatio;\x0A            o.width = t;\x0A            o.height = r;\x0A            o[\x22aspect-ratio\x22] = (t / r).toFixed(2);\x0A            o[\x22device-width\x22] = i;\x0A            o[\x22device-height\x22] = s;\x0A            o[\x22device-aspect-ratio\x22] = (i / s).toFixed(2);\x0A            o.color = u;\x0A            o[\x22color-index\x22] = Math.pow(2, u);\x0A            o.orientation = r >= t ? \x22portrait\x22 : \x22landscape\x22;\x0A            o.resolution = a && a * 96 || e.screen.deviceXDPI || 96;\x0A            o[\x22device-pixel-ratio\x22] = a || 1\x0A        },\x0A        h = function() {\x0A            clearTimeout(f);\x0A            f = setTimeout(function() {\x0A                var t = null,\x0A                    n = i - 1,\x0A                    s = n,\x0A                    o = false;\x0A                if (n >= 0) {\x0A                    c();\x0A                    do {\x0A                        t = r[s - n];\x0A                        if (t) {\x0A                            o = l(t.mql.media);\x0A                            if (o && !t.mql.matches || !o && t.mql.matches) {\x0A                                t.mql.matches = o;\x0A                                if (t.listeners) {\x0A                                    for (var u = 0, a = t.listeners.length; u < a; u++) {\x0A                                        if (t.listeners[u]) {\x0A                                            t.listeners[u].call(e, t.mql)\x0A                                        }\x0A                                    }\x0A                                }\x0A                            }\x0A                        }\x0A                    } while (n--)\x0A                }\x0A            }, 10)\x0A        },\x0A        p = function() {\x0A            var n = t.getElementsByTagName(\x22head\x22)[0],\x0A                r = t.createElement(\x22style\x22),\x0A                i = null,\x0A                o = [\x22screen\x22, \x22print\x22, \x22speech\x22, \x22projection\x22, \x22handheld\x22, \x22tv\x22, \x22braille\x22, \x22embossed\x22, \x22tty\x22],\x0A                u = 0,\x0A                a = o.length,\x0A                f = \x22#mediamatchjs { position: relative; z-index: 0; }\x22,\x0A                l = \x22\x22,\x0A                p = e.addEventListener || (l = \x22on\x22) && e.attachEvent;\x0A            r.type = \x22text/css\x22;\x0A            r.id = \x22mediamatchjs\x22;\x0A            n.appendChild(r);\x0A            i = e.getComputedStyle && e.getComputedStyle(r) || r.currentStyle;\x0A            for (; u < a; u++) {\x0A                f += \x22@media \x22 + o[u] + \x22 { #mediamatchjs { position: relative; z-index: \x22 + u + \x22 } }\x22\x0A            }\x0A            if (r.styleSheet) {\x0A                r.styleSheet.cssText = f\x0A            } else {\x0A                r.textContent = f\x0A            }\x0A            s = o[i.zIndex * 1 || 0];\x0A            n.removeChild(r);\x0A            c();\x0A            p(l + \x22resize\x22, h);\x0A            p(l + \x22orientationchange\x22, h)\x0A        };\x0A    p();\x0A    return function(e) {\x0A        var t = i,\x0A            n = {\x0A                matches: false,\x0A                media: e,\x0A                addListener: function(n) {\x0A                    r[t].listeners || (r[t].listeners = []);\x0A                    n && r[t].listeners.push(n)\x0A                },\x0A                removeListener: function(n) {\x0A                    var i = r[t],\x0A                        s = 0,\x0A                        o = 0;\x0A                    if (!i) {\x0A                        return\x0A                    }\x0A                    o = i.listeners.length;\x0A                    for (; s < o; s++) {\x0A                        if (i.listeners[s] === n) {\x0A                            i.listeners.splice(s, 1)\x0A                        }\x0A                    }\x0A                }\x0A            };\x0A        if (e === \x22\x22) {\x0A            n.matches = true;\x0A            return n\x0A        }\x0A        n.matches = l(e);\x0A        i = r.push({\x0A            mql: n,\x0A            listeners: null\x0A        });\x0A        return n\x0A    }\x0A}(window));\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},42534143:{id:"42534143",name:"SSN - Stylesheet",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script> \x0Avar css =\x22.ssn-styling {\x22+\x0A\x22  margin-top: 15px;\x22+\x0A\x22  padding: 20px;\x22+\x0A\x22  background-color: #FFFFFF;\x22+\x0A\x22  -webkit-border-radius: 8px;\x22+\x0A\x22  -moz-border-radius: 8px;\x22+\x0A\x22  border-radius: 8px;\x22+\x0A\x22  -moz-box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.15);\x22+\x0A\x22  -webkit-box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.15);\x22+\x0A\x22  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.15);\x22+\x0A\x22  text-align: left;\x22+\x0A\x22  display: inline-block;\x22+\x0A\x22  min-height: 250px;\x22+\x0A\x22  min-width: 300px;\x22+\x0A\x22}\x22+\x0A\x22@media all and (min-width: 724px) and (max-width: 1023px) {\x22+\x0A\x22  .bpp-layout-side-bar .ssn-styling {\x22+\x0A\x22    margin-top: 0;\x22+\x0A\x22  }\x22+\x0A\x22}\x22+\x0A\x22@media all and (min-width: 724px) and (max-width: 1023px) {\x22+\x0A\x22    .ssn-styling {\x22+\x0A\x22      display: block;\x22+\x0A\x22    }\x22+\x0A\x22  \x22+\x0A\x22}\x22+\x0A\x22@media all and (max-width: 723px) {\x22+\x0A\x22    .ssn-styling {\x22+\x0A\x22      margin-top: 15px;\x22+\x0A\x22    }\x22+\x0A\x22}\x22+\x0A\x22@media all  and (min-width: 320px) and (max-width: 368px) {\x22+\x0A\x22    .ssn-styling {\x22+\x0A\x22      padding: 4px !important;\x22+\x0A\x22  }\x22+\x0A\x22}\x22+\x0A\x22div.sensisSSNAds {\x22 +\x0A\x22  color: black;\x22 +\x0A\x22  font-family: arial, sans-serif;\x22 +\x0A\x22  font-size: 12px;\x22 +\x0A\x22  margin: 8px 8px 4px 8px;\x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds h2.ssnHeading {\x22 +\x0A\x22  height: 19px;\x22 +\x0A\x22  line-height: 1.5em;\x22 +\x0A\x22  margin: 0px 0px 4px 0px;\x22 +\x0A\x22  font-size: 13px;\x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds h2.ssnHeading .headerText {\x22 +\x0A\x22  font-family: arial, sans-serif;\x22 +\x0A\x22  color: #676767;\x22 +\x0A\x22  font-weight: normal;\x22 +\x0A\x22  padding-left: 3px;\x22 +\x0A\x22  padding-right: 3px;\x22 +\x0A\x22  letter-spacing: 0;\x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds .descText {\x22 +\x0A\x22  font-size: 12px;\x22 +\x0A\x22  line-height: 1.4em;\x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds .titleLink {\x22 +\x0A\x22  font-size: 13px;\x22 +\x0A\x22  color: #005e88;\x22 +\x0A\x22  font-weight: normal;\x22 +\x0A\x22  display: inline-block;\x22 +\x0A\x22  text-decoration: underline;  \x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds .secondLink {\x22 +\x0A\x22  text-decoration: none;  \x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds .domainLink {\x22 +\x0A\x22  color: #008000;\x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds .adStd {\x22 +\x0A\x22  padding: 4px 4px 4px 4px;\x22 +\x0A\x22  line-height: normal;\x22 +\x0A\x22}\x22 +\x0A\x22\x22 +\x0A\x22.sensisSSNAds strong, .sensisSSNAds b {\x22 +\x0A\x22  font-weight: bold;\x22 +\x0A\x22}\x22;\x0A\x0Avar head = document.head || document.getElementsByTagName(\x27head\x27)[0];\x0Avar style = document.createElement(\x27style\x27);\x0A\x0Astyle.type = \x27text/css\x27;\x0Aif (style.styleSheet){\x0A  style.styleSheet.cssText = css;\x0A} else {\x0A  style.appendChild(document.createTextNode(css));\x0A}\x0A\x0Ahead.appendChild(style);\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},42534149:{id:"42534149",name:"MREC - Stylesheet",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script> \x0Avar css = \x22.mrec-styling{margin-top:15px;padding:20px;background-color:#FFFFFF;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;-moz-box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.15);-webkit-box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.15);box-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.15);text-align:left;display:inline-block;width:300px;min-height:250px}.iframeMrec{width:300px !important;height:250px !important;border:0}@media all and (max-width: 1023px){.bpp-layout-side-bar .mrec-styling{margin-top:0}}@media all and (min-width: 320px) and (max-width: 368px){.mrec-styling{padding:4px}}\x22,\x0A    head = document.head || document.getElementsByTagName(\x27head\x27)[0],\x0A    style = document.createElement(\x27style\x27);\x0A\x0Astyle.type = \x27text/css\x27;\x0Aif (style.styleSheet){\x0A  style.styleSheet.cssText = css;\x0A} else {\x0A  style.appendChild(document.createTextNode(css));\x0A}\x0A\x0Ahead.appendChild(style);\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},42534156:{id:"42534156",name:"MREC - MREC 1",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script type=\x27text/javascript\x27>\x0Avar googletag = googletag || {};\x0Agoogletag.cmd = googletag.cmd || [];\x0A(function() {\x0A	var gads = document.createElement(\x27script\x27);\x0A	gads.async = true;\x0A	gads.type = \x27text/javascript\x27;\x0A	var useSSL = \x27https:\x27 == document.location.protocol;\x0A	gads.src = (useSSL ? \x27https:\x27 : \x27http:\x27) + \x27//www.googletagservices.com/tag/js/gpt.js\x27;\x0A	var node = document.getElementsByTagName(\x27script\x27)[0];\x0A	node.parentNode.insertBefore(gads, node);\x0A\x0A  	var section = \x22${pageType}\x22;\x0A	var state = \x22${state}\x22;\x0A	var pcode = \x22${postCode}\x22;\x0A	var category = \x22${headingName}\x22;\x0A	var categoryId = \x22${headingId}\x22;\x0A	var busname = \x22${busName}\x22;\x0A	var listtype = \x22${isFreeListing}\x22;\x0A  	var kruxUser = \x22${kruxUser}\x22;\x0A  \x0A  	var networkId = \x22${networkId}\x22;\x0A    var targeting = \x22${targeting}\x22;\x0A    var slotPath = \x22/\x22+ networkId +\x22/yellowpages/BPP\x22;\x0A\x0A  $(\x22#mrec\x22).addClass(\x22mrec-styling\x22);\x0A\x0A  // This uses test adserver instance 267198596 and differs from test and production containers\x0A  \x0A	googletag.cmd.push(function() {\x0A        googletag.defineSlot(slotPath, [300, 250], \x27mrec\x27).addService(googletag.pubads()).setTargeting(\x27pos\x27, \x27MREC\x27).setCollapseEmptyDiv(false);\x0A        googletag.pubads().setTargeting(\x27site\x27, \x27yellowpages\x27);\x0A        googletag.pubads().setTargeting(\x27section\x27, section);\x0A        googletag.pubads().setTargeting(\x27category\x27, category);\x0A        googletag.pubads().setTargeting(\x27state\x27, state);\x0A        googletag.pubads().setTargeting(\x27pcode\x27, pcode);\x0A        googletag.pubads().setTargeting(\x27busname\x27, busname);\x0A        googletag.pubads().setTargeting(\x27listtype\x27, listtype);\x0A        googletag.pubads().setTargeting(\x27env\x27, targeting);\x0A        googletag.pubads().setTargeting(\x22kuid\x22, kruxUser);\x0A        googletag.enableServices();\x0A        googletag.display(\x27mrec\x27);\x0A	});\x0A})();\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{"-2621177":{token:"pageType",defaultValue:""},"-2621178":{token:"state",defaultValue:""},"-2621179":{token:"headingName",defaultValue:""},"-2621180":{token:"busName",defaultValue:""},"-2621181":{token:"headingId",defaultValue:""},"-2621182":{token:"isFreeListing",defaultValue:""},"-2621183":{token:"postCode",defaultValue:""},"-2621184":{token:"networkId",defaultValue:""},"-2621185":{token:"targeting",defaultValue:""},"-2621186":{token:"kruxUser",defaultValue:""}},dependencies:[42534149,43389013,47531974]},42534157:{id:"42534157",name:"SSN - MREC 2",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script type=\x27text/javascript\x27>\x0Avar googletag = googletag || {};\x0Agoogletag.cmd = googletag.cmd || [];\x0A(function() {\x0A	var gads = document.createElement(\x27script\x27);\x0A	gads.async = true;\x0A	gads.type = \x27text/javascript\x27;\x0A	var useSSL = \x27https:\x27 == document.location.protocol;\x0A	gads.src = (useSSL ? \x27https:\x27 : \x27http:\x27) + \x27//www.googletagservices.com/tag/js/gpt.js\x27;\x0A	var node = document.getElementsByTagName(\x27script\x27)[0];\x0A	node.parentNode.insertBefore(gads, node);\x0A\x0A  	var section = \x22${pageType}\x22;\x0A	var state = \x22${state}\x22;\x0A	var pcode = \x22${postCode}\x22;\x0A	var category = \x22${headingName}\x22;\x0A	var categoryId = \x22${headingId}\x22;\x0A	var busname = \x22${busName}\x22;\x0A	var listtype = \x22${isFreeListing}\x22;\x0A  	var containingDivSSN = \x22${adPos1DivId}\x22;\x0A  	var kruxUser = \x22${kruxUser}\x22;\x0A  \x0A  	var networkId = \x22${networkId}\x22;\x0A    var targeting = \x22${targeting}\x22;\x0A    var slotPath = \x22/\x22+ networkId +\x22/SENSIS.SSN/YELLOWPAGES\x22;\x0A  \x0A	$(\x22#\x22 + containingDivSSN).addClass(\x22ssn-styling\x22);\x0A\x0A  // This uses test adserver instance 267198596 and differs from test and production containers\x0A  \x0A	googletag.cmd.push(function() {\x0A        googletag.defineSlot(slotPath, [300, 250], \x27ssn\x27).addService(googletag.pubads()).setTargeting(\x27pos\x27, \x27SSN\x27).setCollapseEmptyDiv(true);\x0A        googletag.pubads().setTargeting(\x27site\x27, \x27yellowpages\x27);\x0A        googletag.pubads().setTargeting(\x27section\x27, section);\x0A        googletag.pubads().setTargeting(\x27category\x27, category);\x0A        googletag.pubads().setTargeting(\x27state\x27, state);\x0A        googletag.pubads().setTargeting(\x27pcode\x27, pcode);\x0A        googletag.pubads().setTargeting(\x27busname\x27, busname);\x0A        googletag.pubads().setTargeting(\x27listtype\x27, listtype);\x0A        googletag.pubads().setTargeting(\x27env\x27, targeting);\x0A        googletag.pubads().setTargeting(\x22kuid\x22, kruxUser);\x0A        googletag.enableServices();\x0A        googletag.display(\x27ssn\x27);\x0A	});\x0A})();\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{"-2621187":{token:"pageType",defaultValue:""},"-2621188":{token:"state",defaultValue:""},"-2621189":{token:"headingName",defaultValue:""},"-2621190":{token:"busName",defaultValue:""},"-2621191":{token:"headingId",defaultValue:""},"-2621192":{token:"isFreeListing",defaultValue:""},"-2621193":{token:"postCode",defaultValue:""},"-2621194":{token:"adPos1DivId",defaultValue:""},"-2621195":{token:"networkId",defaultValue:""},"-2621196":{token:"targeting",defaultValue:""},"-2621197":{token:"kruxUser",defaultValue:""}},dependencies:[42534143,43389013,47531974]},42534165:{id:"42534165",name:"Leaderboard",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script type=\x27text/javascript\x27>\x0A  var googletag = googletag || {};\x0A  googletag.cmd = googletag.cmd || [];\x0A  (function() {\x0A    var gads = document.createElement(\x27script\x27);\x0A    gads.async = true;\x0A    gads.type = \x27text/javascript\x27;\x0A    var useSSL = \x27https:\x27 == document.location.protocol;\x0A    gads.src = (useSSL ? \x27https:\x27 : \x27http:\x27) + \x27//www.googletagservices.com/tag/js/gpt.js\x27;\x0A    var node = document.getElementsByTagName(\x27script\x27)[0];\x0A    node.parentNode.insertBefore(gads, node);\x0A    \x0A    var section = \x22${pageType}\x22;\x0A    var state = \x22${state}\x22;\x0A    var region = \x22${regions}\x22;\x0A    var pcode = \x22${postcodes}\x22;\x0A    var query = \x22${searchTerm}\x22;\x0A    var category = \x22${category}\x22;\x0A    var categoryId = \x22${heading}\x22;\x0A    var adPos2DivId = \x22${adPos2DivId}\x22;\x0A    var kruxUser = \x22${kruxUser}\x22;\x0A    \x0A    var networkId = \x22${networkId}\x22;\x0A    var targeting = \x22${targeting}\x22;\x0A    var defineslotPath = \x22/\x22+ networkId +\x22/yellowpages/\x22 + section + \x22/\x22 + category;\x0A    \x0A    // This uses test adserver instance 267198596 and differs from test and production containers\x0A\x0A    googletag.cmd.push(function() {\x0A      googletag.defineSlot(defineslotPath, [728, 90], \x27platinumBanner\x27).addService(googletag.pubads()).setTargeting(\x27pos\x27, \x272\x27).setCollapseEmptyDiv(true);\x0A      googletag.pubads().setTargeting(\x27site\x27, \x27yellowpages\x27);\x0A      googletag.pubads().setTargeting(\x27section\x27, section);\x0A      googletag.pubads().setTargeting(\x27category\x27, category);\x0A      googletag.pubads().setTargeting(\x27state\x27, state);\x0A      googletag.pubads().setTargeting(\x27region\x27, region);\x0A      googletag.pubads().setTargeting(\x27pcode\x27, pcode);\x0A      googletag.pubads().setTargeting(\x27query\x27, query);\x0A      googletag.pubads().setTargeting(\x27env\x27, \x27ypdisplaytest\x27);\x0A      googletag.pubads().setTargeting(\x22kuid\x22, kruxUser);\x0A      googletag.pubads().enableSingleRequest();\x0A      googletag.enableServices();\x0A      googletag.display(\x27platinumBanner\x27);\x0A    });\x0A  })();\x0A<\/script>",locationId:3,positionId:1,locationDetail:"platinumBanner",async:true,needsConsent:false,usesDocWrite:false,pageVars:{"-2621198":{token:"pageType",defaultValue:""},"-2621199":{token:"regions",defaultValue:""},"-2621200":{token:"postcodes",defaultValue:""},"-2621201":{token:"heading",defaultValue:""},"-2621202":{token:"adPos2DivId",defaultValue:""},"-2621203":{token:"state",defaultValue:""},"-2621204":{token:"category",defaultValue:""},"-2621205":{token:"searchTerm",defaultValue:""},"-2621206":{token:"targeting",defaultValue:""},"-2621207":{token:"networkId",defaultValue:""},"-2621208":{token:"kruxUser",defaultValue:""}},dependencies:[42534180,43389013,47531974]},42534180:{id:"42534180",name:"Leaderboard - Stylesheet",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script> \x0Avar css =\x22#platinumBanner {\x22+\x0A\x22	padding-top: 10px;\x22+\x0A\x22	padding-bottom: 15px;\x22+\x0A\x22 	text-align: center;\x22 +   \x0A\x22	display: none;\x22+\x0A\x22}\x22+\x0A\x22@media all and (min-width: 768px) {\x22+\x0A\x22    #platinumBanner {\x22+\x0A\x22        display: block;\x22+\x0A\x22    }\x22+\x0A\x22}\x22;\x0A\x0Avar head = document.head || document.getElementsByTagName(\x27head\x27)[0];\x0Avar style = document.createElement(\x27style\x27);\x0A\x0Astyle.type = \x27text/css\x27;\x0Aif (style.styleSheet){\x0A  style.styleSheet.cssText = css;\x0A} else {\x0A  style.appendChild(document.createTextNode(css));\x0A}\x0A\x0Ahead.appendChild(style);\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},43389013:{id:"43389013",name:"EnviromentConfig",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script>\x0Avar Config = {\x0AnetworkId:\x227434\x22,\x0A  // Sensis Network = 7434\x0A  // Human Traffic Test Network = 267198596\x0Atargeting: \x22ypproduction\x22\x0A  // Test Targeting = ypdisplaytest\x0A  // Production Targeting = ypproduction\x0A};\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},43701619:{id:"43701619",name:"Krux",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<!-- BEGIN Krux Control Tag for \x22Yellow Pages\x22 -->\x0A<!-- Source: /snippet/controltag?confid=J6KxPT5z&site=Yellow%20Pages&edit=1 -->\x0A<script type=\x22text/javascript\x22 class=\x22kxct\x22 data-id=\x22J6KxPT5z\x22 data-timing=\x22async\x22 data-version=\x221.9\x22 >\x0A	window.Krux||((Krux=function(){Krux.q.push(arguments)}).q=[]);\x0A(function(){\x0A	var k=document.createElement(\x27script\x27);k.type=\x27text/javascript\x27;k.async=true;\x0A	var m,src=(m=location.href.match(/\x5Cbkxsrc=([^&]+)/))&&decodeURIComponent(m[1]);\x0A	k.src = /^https?:\x5C/\x5C/([a-z0-9_\x5C-\x5C.]+\x5C.)?krxd\x5C.net(:\x5Cd{1,5})?\x5C//i.test(src) ? src : src === \x22disable\x22 ? \x22\x22 :\x0A	(location.protocol===\x22https:\x22?\x22https:\x22:\x22http:\x22)+\x22//cdn.krxd.net/controltag?confid=J6KxPT5z\x22\x0A	;\x0A	var s=document.getElementsByTagName(\x27script\x27)[0];s.parentNode.insertBefore(k,s);\x0A}());\x0A<\/script>\x0A<!-- END Krux Controltag -->",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},47531974:{id:"47531974",name:"krux Interchange",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"\x0A\x0A<script class=\x22kxint\x22 data-namespace=\x22sensis\x22 type=\x22text/javascript\x22>\x0A  window.Krux||((Krux=function(){Krux.q.push(arguments);}).q=[]);\x0A  (function(){\x0A    \x0A    // Namespace sensis\x0A    var Krux = this.Krux.sensis = this.Krux.sensis || {};\x0A    \x0A    function retrieve(n){\x0A      var m, k=\x27kxsensis_\x27+n;\x0A      if (window.localStorage) {\x0A          return window.localStorage[k] || \x22\x22;\x0A      } else if (navigator.cookieEnabled) {\x0A          m = document.cookie.match(k+\x27=([^;]*)\x27);\x0A          return (m && unescape(m[1])) || \x22\x22;\x0A      } else {\x0A          return \x27\x27;\x0A      }\x0A    }\x0A \x0A    Krux.user = retrieve(\x27user\x27);\x0A    Krux.segments = retrieve(\x27segs\x27) ? retrieve(\x27segs\x27).split(\x27,\x27) : [];\x0A    \x0A  })();\x0A<\/script>\x0A",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]}};
var tellLoadTimesProbability=1;var pingServerUrl="pong.qubitproducts.com";var qtag_domain="";var delayDocWrite=false;var maxCookieLength=0;var mainConfig={};try{mainConfig.filters=filters}catch(e){}try{mainConfig.pageVars=pageVars}catch(e){}try{mainConfig.scriptLoaders=scriptLoaders}catch(e){}try{mainConfig.delayDocWrite=delayDocWrite}catch(e){}try{mainConfig.qTagClientId=qTagClientId}catch(e){}try{mainConfig.containerName=containerName}catch(e){}try{mainConfig.profileName=profileName}catch(e){}try{mainConfig.tellLoadTimesProbability=tellLoadTimesProbability}catch(e){}try{mainConfig.containerDisabled=containerDisabled}catch(e){}try{mainConfig.maxCookieLength=maxCookieLength}catch(e){}try{mainConfig.pingServerUrl=pingServerUrl}catch(e){}try{mainConfig.qtag_track_session=qtag_track_session}catch(e){}try{mainConfig.qtag_domain=qtag_domain}catch(e){}try{mainConfig.scriptURL=scriptURL}catch(e){}mainConfig.qtag_track_session=true;var Cookie=qubit.Cookie;function requestedDebugMode(){var isDebug=false;if(Cookie.get("opentag_debug")||document.location.href.indexOf("opentag_debug")>=0){isDebug=true}return isDebug}function requestedDebugTool(){var isDebug=false;if(Cookie.get("opentag_debug_tool")||document.location.href.indexOf("opentag_debug_tool")>=0){isDebug=true}return isDebug}function disabled(){if(document.location.href.indexOf("opentag_disabled=true")>=0){return true}return false}var started=false;function old(mainConfig){if(disabled()){return}if(started){return}started=true;var selfDebug=false;var otRef=qubit.opentag;var debugToolRequested=requestedDebugTool();var debugRequested=debugToolRequested||requestedDebugMode();if(!selfDebug&&debugRequested){var debugScript=document.createElement("script");var url;if(mainConfig.scriptURL){url=mainConfig.scriptURL;var dLen="-debug.js".length;if(url.lastIndexOf("-debug.js")!==url.length-dLen){url=url.substring(0,url.length-".js".length);url+="-debug.js"}}var urlCDN="//d3c3cq33003psk.cloudfront.net/opentag-"+mainConfig.qTagClientId+"-"+mainConfig.profileName+"-debug.js";if(url&&urlCDN!==url){debugScript.src=url}else{debugScript.src="//s3-eu-west-1.amazonaws.com/opentag/opentag-"+mainConfig.qTagClientId+"-"+mainConfig.profileName+"-debug.js"}if(!otRef.Log){GLOBAL.TAGSDK_NS_OVERRIDE=true}else{GLOBAL.TAGSDK_NS_OVERRIDE=false}document.getElementsByTagName("head")[0].appendChild(debugScript);return}if(otRef.Log){GLOBAL.TAGSDK_NS_OVERRIDE=false}new qubit.opentag.OldTagRunner(mainConfig).run()}try{q.html.UVListener.init()}catch(uvInitFalure){}old(mainConfig)})()}())}catch(e){try{console.log(e)}catch(ex){}};